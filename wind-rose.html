<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°”è±¡æ•°æ®å¯è§†åŒ–å¹³å° - æ•°æ®åˆ†æè¯¦æƒ…</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #e0e7ff;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #5bc0de;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #aaccff;
            font-size: 1.2rem;
        }
        
        .chart-type-selector {
            text-align: center;
            margin: 20px 0;
        }
        
        .chart-type-selector select {
            background: rgba(30, 50, 70, 0.7);
            color: #e0e7ff;
            border: 1px solid rgba(91, 192, 222, 0.4);
            border-radius: 5px;
            padding: 8px 15px;
            font-size: 1rem;
            outline: none;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .city-selector {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .city-selector select {
            background: rgba(30, 50, 70, 0.7);
            color: #e0e7ff;
            border: 1px solid rgba(91, 192, 222, 0.4);
            border-radius: 5px;
            padding: 8px 15px;
            font-size: 1rem;
            outline: none;
            cursor: pointer;
            min-width: 200px;
        }
        
        .city-checkbox-selector {
            display: none;
            background: rgba(30, 50, 70, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(91, 192, 222, 0.4);
        }
        
        .city-checkbox-selector h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #5bc0de;
        }
        
        .city-checkbox-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .city-checkbox-item {
            display: flex;
            align-items: center;
            margin: 5px;
        }
        
        .city-checkbox-item input[type="checkbox"] {
            margin-right: 5px;
            cursor: pointer;
        }
        
        .city-checkbox-item label {
            cursor: pointer;
            color: #e0e7ff;
        }
        
        .city-checkbox-item input[type="checkbox"]:checked + label {
            color: #5bc0de;
            font-weight: bold;
        }
        
        .selection-info {
            text-align: center;
            margin-top: 10px;
            color: #aaccff;
            font-size: 0.9rem;
        }
        
        .chart-container {
            background: rgba(30, 50, 70, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(91, 192, 222, 0.2);
        }
        
        #chart-display {
            width: 100%;
            height: 600px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #chart-display:hover {
            transform: scale(1.01);
        }
        
        .city-label {
            text-align: center;
            margin-top: 15px;
            font-size: 1.2rem;
            color: #5bc0de;
            font-weight: bold;
        }
        
        .back-button {
            display: block;
            margin: 20px auto;
            padding: 10px 25px;
            background: linear-gradient(90deg, #5bc0de, #4a90e2);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: bold;
            text-align: center;
            width: 200px;
            transition: all 0.3s;
        }
        
        .back-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .instructions {
            background: rgba(20, 40, 60, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #aaccff;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #5bc0de;
            font-size: 1.2rem;
        }
        
        .error {
            text-align: center;
            padding: 50px;
            color: #ff6b6b;
            font-size: 1.2rem;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #ff6b6b;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="page-title">æ•°æ®åˆ†æè¯¦æƒ…</h1>
            <p id="page-description">å±•ç¤ºè¯¦ç»†æ°”è±¡æ•°æ®åˆ†æ</p>
        </div>
        
        <div class="chart-type-selector">
            <label for="chart-type-select">é€‰æ‹©å›¾è¡¨ç±»å‹: </label>
            <select id="chart-type-select">
                <option value="temperature">å¹´å¹³å‡æ°”æ¸©</option>
                <option value="weather">å¤©æ°”æƒ…å†µåˆ†å¸ƒ</option>
                <option value="wind">é£é€Ÿä¸é£å‘ç«ç‘°å›¾</option>
            </select>
        </div>
        
        <div class="city-selector" id="wind-city-selector">
            <label for="wind-city-select">é€‰æ‹©åŸå¸‚: </label>
            <select id="wind-city-select">
                <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </select>
        </div>
        
        <div class="city-checkbox-selector" id="temperature-city-selector">
            <h3>é€‰æ‹©åŸå¸‚ (æœ€å¤šå¯é€‰10ä¸ª)</h3>
            <div class="city-checkbox-container" id="temperature-city-checkbox">
                <!-- å¤é€‰æ¡†å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="selection-info" id="temperature-selection-info">å·²é€‰æ‹© 4 ä¸ªåŸå¸‚</div>
        </div>
        
        <div class="city-checkbox-selector" id="weather-city-selector">
            <h3>é€‰æ‹©åŸå¸‚ (æœ€å¤šå¯é€‰10ä¸ª)</h3>
            <div class="city-checkbox-container" id="weather-city-checkbox">
                <!-- å¤é€‰æ¡†å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="selection-info" id="weather-selection-info">å·²é€‰æ‹© 4 ä¸ªåŸå¸‚</div>
        </div>
        
        <div class="chart-container">
            <div id="chart-display">
                <div class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
            </div>
            <div class="city-label" id="city-name"></div>
        </div>
        
        <a href="index.html" class="back-button">è¿”å›ä¸»é¡µé¢</a>
        
        <div class="instructions" id="chart-instructions">
            <p>ğŸ’¡ æç¤ºï¼šè¿™é‡Œå°†æ˜¾ç¤ºæ‚¨é€‰æ‹©çš„æ•°æ®åˆ†æå›¾è¡¨ã€‚</p>
        </div>
    </div>

    <div class="toast" id="toast">æœ€å¤šåªèƒ½é€‰æ‹©10ä¸ªåŸå¸‚</div>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        const chartDom = document.getElementById('chart-display');
        const chart = echarts.init(chartDom);
        const toast = document.getElementById('toast');
        
        // çœä¼šåŸå¸‚åˆ—è¡¨åŠå…¶åæ ‡
        const capitalCities = {
            'beijing': { name: 'åŒ—äº¬', coordinates: [116.41, 39.90] },
            'shanghai': { name: 'ä¸Šæµ·', coordinates: [121.48, 31.22] },
            'tianjin': { name: 'å¤©æ´¥', coordinates: [117.20, 39.13] },
            'chongqing': { name: 'é‡åº†', coordinates: [106.54, 29.59] },
            'haerbin': { name: 'å“ˆå°”æ»¨', coordinates: [126.63, 45.75] },
            'changchun': { name: 'é•¿æ˜¥', coordinates: [125.32, 43.90] },
            'shenyang': { name: 'æ²ˆé˜³', coordinates: [123.43, 41.80] },
            'huhehaote': { name: 'å‘¼å’Œæµ©ç‰¹', coordinates: [111.65, 40.82] },
            'shijiazhuang': { name: 'çŸ³å®¶åº„', coordinates: [114.48, 38.03] },
            'xining': { name: 'è¥¿å®', coordinates: [101.74, 36.56] },
            'lanzhou': { name: 'å…°å·', coordinates: [103.73, 36.03] },
            'yinchuan': { name: 'é“¶å·', coordinates: [106.27, 38.47] },
            'xian': { name: 'è¥¿å®‰', coordinates: [108.93, 34.27] },
            'zhengzhou': { name: 'éƒ‘å·', coordinates: [113.62, 34.72] },
            'jinan': { name: 'æµå—', coordinates: [117.00, 36.65] },
            'taiyuan': { name: 'å¤ªåŸ', coordinates: [112.53, 37.87] },
            'hefei': { name: 'åˆè‚¥', coordinates: [117.27, 31.86] },
            'wuhan': { name: 'æ­¦æ±‰', coordinates: [114.31, 30.52] },
            'changsha': { name: 'é•¿æ²™', coordinates: [113.00, 28.21] },
            'nanjing': { name: 'å—äº¬', coordinates: [118.78, 32.04] },
            'chengdu': { name: 'æˆéƒ½', coordinates: [104.06, 30.67] },
            'guiyang': { name: 'è´µé˜³', coordinates: [106.71, 26.57] },
            'kunming': { name: 'æ˜†æ˜', coordinates: [102.73, 25.04] },
            'nanning': { name: 'å—å®', coordinates: [108.37, 22.82] },
            'lasa': { name: 'æ‹‰è¨', coordinates: [91.11, 29.61] },
            'hangzhou': { name: 'æ­å·', coordinates: [120.19, 30.26] },
            'fuzhou': { name: 'ç¦å·', coordinates: [119.30, 26.08] },
            'guangzhou': { name: 'å¹¿å·', coordinates: [113.23, 23.16] },
            'haikou': { name: 'æµ·å£', coordinates: [110.35, 20.02] },
            'urumqi': { name: 'ä¹Œé²æœ¨é½', coordinates: [87.62, 43.82] }
        };

        // é»˜è®¤é€‰ä¸­çš„åŸå¸‚
        const defaultSelectedCities = ['beijing', 'shanghai', 'guangzhou', 'chengdu'];
        
        // å­˜å‚¨å†å²æ•°æ®
        let historicalData = {};
        
        // ä»URLè·å–å‚æ•°
        function getParamFromURL(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // ç”ŸæˆåŸå¸‚é€‰æ‹©å¤é€‰æ¡†
        function generateCityCheckboxes(containerId, infoElementId) {
            const container = document.getElementById(containerId);
            const infoElement = document.getElementById(infoElementId);
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // ç»Ÿè®¡å·²é€‰ä¸­çš„åŸå¸‚æ•°é‡
            let selectedCount = 0;
            
            // ä¸ºæ¯ä¸ªåŸå¸‚åˆ›å»ºå¤é€‰æ¡†
            for (const [pinyin, cityInfo] of Object.entries(capitalCities)) {
                const isChecked = defaultSelectedCities.includes(pinyin);
                if (isChecked) selectedCount++;
                
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'city-checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `${containerId}-${pinyin}`;
                checkbox.value = pinyin;
                checkbox.checked = isChecked;
                
                const label = document.createElement('label');
                label.htmlFor = `${containerId}-${pinyin}`;
                label.textContent = cityInfo.name;
                
                checkboxItem.appendChild(checkbox);
                checkboxItem.appendChild(label);
                container.appendChild(checkboxItem);
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                checkbox.addEventListener('change', function() {
                    const selectedCities = getSelectedCities(containerId);
                    
                    if (this.checked && selectedCities.length > 10) {
                        this.checked = false;
                        showToast('æœ€å¤šåªèƒ½é€‰æ‹©10ä¸ªåŸå¸‚');
                        return;
                    }
                    
                    // æ›´æ–°é€‰æ‹©ä¿¡æ¯
                    updateSelectionInfo(containerId, infoElementId);
                    
                    // é‡æ–°æ¸²æŸ“å›¾è¡¨
                    const chartType = document.getElementById('chart-type-select').value;
                    if (chartType === 'temperature') {
                        renderTemperatureChart();
                    } else if (chartType === 'weather') {
                        renderWeatherChart();
                    }
                });
            }
            
            // æ›´æ–°é€‰æ‹©ä¿¡æ¯
            infoElement.textContent = `å·²é€‰æ‹© ${selectedCount} ä¸ªåŸå¸‚`;
        }
        
        // è·å–é€‰ä¸­çš„åŸå¸‚
        function getSelectedCities(containerId) {
            const container = document.getElementById(containerId);
            const checkboxes = container.querySelectorAll('input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }
        
        // æ›´æ–°é€‰æ‹©ä¿¡æ¯
        function updateSelectionInfo(containerId, infoElementId) {
            const selectedCities = getSelectedCities(containerId);
            const infoElement = document.getElementById(infoElementId);
            infoElement.textContent = `å·²é€‰æ‹© ${selectedCities.length} ä¸ªåŸå¸‚`;
        }
        
        // ç”Ÿæˆé£ç«ç‘°å›¾åŸå¸‚é€‰æ‹©ä¸‹æ‹‰èœå•
        function generateWindCitySelect() {
            const selectElement = document.getElementById('wind-city-select');
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            selectElement.innerHTML = '';
            
            // ä¸ºæ¯ä¸ªåŸå¸‚åˆ›å»ºé€‰é¡¹
            for (const [pinyin, cityInfo] of Object.entries(capitalCities)) {
                const option = document.createElement('option');
                option.value = pinyin;
                option.textContent = cityInfo.name;
                selectElement.appendChild(option);
            }
            
            // è®¾ç½®é»˜è®¤é€‰ä¸­
            selectElement.value = 'beijing';
        }
        
        // å¤„ç†é£å‘æ•°æ®
        function processWindData(cityPinyin) {
            // å¦‚æœæ²¡æœ‰çœŸå®æ•°æ®ï¼Œç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            if (!historicalData[cityPinyin]) {
                return generateFallbackWindData();
            }
            
            const cityData = historicalData[cityPinyin];
            const windData = {};
            let totalDays = 0;
            
            // åˆå§‹åŒ–8ä¸ªæ–¹å‘çš„æ•°æ®ç»“æ„
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            directions.forEach(dir => {
                windData[dir] = {
                    totalSpeed: 0,
                    count: 0,
                    frequency: 0,
                    avgSpeed: 0
                };
            });
            
            // å¤„ç†æ¯æ¡æ•°æ®
            cityData.data.forEach(day => {
                if (day['é£å‘é£åŠ›']) {
                    totalDays++;
                    
                    // è§£æé£å‘å’Œé£åŠ›
                    const windInfo = parseWindInfo(day['é£å‘é£åŠ›']);
                    
                    if (windInfo.direction && windInfo.speed) {
                        // å°†ä¸­æ–‡é£å‘è½¬æ¢ä¸ºæ ‡å‡†8æ–¹ä½
                        const stdDirection = convertChineseWindDirectionTo8(windInfo.direction);
                        
                        if (windData[stdDirection]) {
                            windData[stdDirection].totalSpeed += windInfo.speed;
                            windData[stdDirection].count++;
                        }
                    }
                }
            });
            
            // è®¡ç®—å¹³å‡å€¼å’Œé¢‘ç‡
            directions.forEach(dir => {
                if (windData[dir].count > 0) {
                    windData[dir].avgSpeed = windData[dir].totalSpeed / windData[dir].count;
                    windData[dir].frequency = (windData[dir].count / totalDays) * 100;
                }
            });
            
            return windData;
        }
        
        // è§£æé£å‘é£åŠ›å­—ç¬¦ä¸²
        function parseWindInfo(windStr) {
            // ç¤ºä¾‹æ ¼å¼: "ä¸œåŒ—é£ 1çº§"
            const directionMatch = windStr.match(/([\u4e00-\u9fa5]+é£)/);
            const speedMatch = windStr.match(/(\d+)çº§/);
            
            let direction = null;
            let speed = 0;
            
            if (directionMatch) {
                direction = directionMatch[1];
            }
            
            if (speedMatch) {
                speed = parseFloat(speedMatch[1]);
                // å°†é£çº§è½¬æ¢ä¸ºé£é€Ÿ(km/h)ï¼Œä½¿ç”¨è¿‘ä¼¼å…¬å¼: é£é€Ÿ â‰ˆ é£çº§ * 5
                speed = speed * 5;
            }
            
            return { direction, speed };
        }
        
        // å°†ä¸­æ–‡é£å‘è½¬æ¢ä¸º8ä¸ªæ ‡å‡†æ–¹å‘
        function convertChineseWindDirectionTo8(chineseDir) {
            // æ›´ç²¾ç¡®çš„æ˜ å°„
            const directionMap = {
                'åŒ—é£': 'N',
                'ä¸œåŒ—é£': 'NE', 
                'ä¸œé£': 'E',
                'ä¸œå—é£': 'SE',
                'å—é£': 'S',
                'è¥¿å—é£': 'SW',
                'è¥¿é£': 'W',
                'è¥¿åŒ—é£': 'NW',
                'åŒ—': 'N',
                'ä¸œåŒ—': 'NE', 
                'ä¸œ': 'E',
                'ä¸œå—': 'SE',
                'å—': 'S',
                'è¥¿å—': 'SW',
                'è¥¿': 'W',
                'è¥¿åŒ—': 'NW'
            };
            
            // å°è¯•ç²¾ç¡®åŒ¹é…
            if (directionMap[chineseDir]) {
                return directionMap[chineseDir];
            }
            
            // å°è¯•åŒ…å«åŒ¹é…
            for (const key in directionMap) {
                if (chineseDir.includes(key)) {
                    return directionMap[key];
                }
            }
            
            console.warn(`æ— æ³•è¯†åˆ«é£å‘: ${chineseDir}ï¼Œä½¿ç”¨é»˜è®¤å€¼åŒ—é£`);
            return 'N'; // é»˜è®¤è¿”å›åŒ—é£
        }
        
        // ç”Ÿæˆå¤‡ç”¨æ•°æ®ï¼ˆå½“çœŸå®æ•°æ®ä¸å¯ç”¨æ—¶ï¼‰
        function generateFallbackWindData() {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const windData = {};
            
            directions.forEach(dir => {
                windData[dir] = {
                    avgSpeed: Math.random() * 15 + 5,
                    frequency: Math.random() * 15 + 5
                };
            });
            
            return windData;
        }
        
        // åŠ è½½å†å²æ•°æ®
        async function loadHistoricalData() {
            const dataLoadPromises = [];
            
            for (const [cityPinyin, cityInfo] of Object.entries(capitalCities)) {
                const promise = fetch(`data/${cityPinyin}.json`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`ç½‘ç»œå“åº”ä¸æ­£å¸¸: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        historicalData[cityPinyin] = {
                            name: cityInfo.name,
                            coordinates: cityInfo.coordinates,
                            data: data
                        };
                        console.log(`${cityInfo.name}å†å²æ•°æ®åŠ è½½æˆåŠŸ`, data);
                    })
                    .catch(error => {
                        console.error(`åŠ è½½ ${cityInfo.name} å†å²æ•°æ®å¤±è´¥:`, error);
                        // ä½¿ç”¨æ¨¡æ‹Ÿå†å²æ•°æ®ä½œä¸ºåå¤‡
                        historicalData[cityPinyin] = {
                            name: cityInfo.name,
                            coordinates: cityInfo.coordinates,
                            data: generateSimulatedHistoricalData(cityInfo.name)
                        };
                    });
                
                dataLoadPromises.push(promise);
            }
            
            await Promise.allSettled(dataLoadPromises);
            console.log('å†å²æ•°æ®åŠ è½½å®Œæˆ', historicalData);
            
            // åˆå§‹åŒ–å›¾è¡¨
            initChart();
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿå†å²æ•°æ®ï¼ˆä¸index.htmlä¸­çš„å‡½æ•°ç›¸åŒï¼‰
        function generateSimulatedHistoricalData(cityName) {
            const data = [];
            const startDate = new Date(2020, 0, 1);
            
            for (let i = 0; i < 365 * 3; i++) { // 3å¹´çš„æ•°æ®
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const dateStr = currentDate.toISOString().split('T')[0];
                const weekDays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
                const weekDay = weekDays[currentDate.getDay()];
                
                // æ ¹æ®åŸå¸‚å’Œå­£èŠ‚ç”Ÿæˆä¸åŒçš„æ¸©åº¦
                let baseTemp = 15;
                if (cityName.includes('åŒ—äº¬') || cityName.includes('å“ˆå°”æ»¨')) {
                    baseTemp = 10;
                } else if (cityName.includes('å¹¿å·') || cityName.includes('æµ·å£')) {
                    baseTemp = 25;
                }
                
                // å­£èŠ‚å½±å“
                const month = currentDate.getMonth();
                let seasonalEffect = 0;
                if (month >= 2 && month <= 4) { // æ˜¥å­£
                    seasonalEffect = 5;
                } else if (month >= 5 && month <= 7) { // å¤å­£
                    seasonalEffect = 15;
                } else if (month >= 8 && month <= 10) { // ç§‹å­£
                    seasonalEffect = 5;
                } else { // å†¬å­£
                    seasonalEffect = -5;
                }
                
                const highTemp = Math.round(baseTemp + seasonalEffect + (Math.random() * 10 - 5));
                const lowTemp = Math.round(highTemp - 5 - Math.random() * 5);
                
                const weatherTypes = ['æ™´', 'å¤šäº‘', 'é˜´', 'å°é›¨', 'ä¸­é›¨', 'å¤§é›¨', 'é›ª'];
                const weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
                
                const windDirections = ['åŒ—é£', 'ä¸œåŒ—é£', 'ä¸œé£', 'ä¸œå—é£', 'å—é£', 'è¥¿å—é£', 'è¥¿é£', 'è¥¿åŒ—é£'];
                const windDirection = windDirections[Math.floor(Math.random() * windDirections.length)];
                const windLevel = Math.floor(Math.random() * 5) + 1;
                
                data.push({
                    "æ—¥æœŸ": `${dateStr} ${weekDay}`,
                    "æœ€é«˜æ¸©": `${highTemp}â„ƒ`,
                    "æœ€ä½æ¸©": `${lowTemp}â„ƒ`,
                    "å¤©æ°”": weather,
                    "é£å‘é£åŠ›": `${windDirection} ${windLevel}çº§`
                });
            }
            
            return data;
        }
        
        // å¤„ç†æ¸©åº¦æ•°æ®ï¼Œä»å­—ç¬¦ä¸²ä¸­æå–æ•°å­—
        function parseTemperature(tempStr) {
            if (!tempStr) return null;
            const match = tempStr.match(/(-?\d+)â„ƒ/);
            return match ? parseInt(match[1]) : null;
        }
        
        // è®¡ç®—åŸå¸‚å¹´å¹³å‡æ°”æ¸©
        function calculateYearlyAverageTemperatures(cityData) {
            const yearlyTemps = {};
            
            cityData.data.forEach(day => {
                const datePart = day.æ—¥æœŸ.split(' ')[0]; // è·å–æ—¥æœŸéƒ¨åˆ†
                const date = new Date(datePart);
                // æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
                if (isNaN(date.getTime())) {
                    console.warn('æ— æ•ˆæ—¥æœŸ:', day.æ—¥æœŸ);
                    return;
                }
                
                const year = date.getFullYear();
                
                if (!yearlyTemps[year]) {
                    yearlyTemps[year] = {
                        sum: 0,
                        count: 0
                    };
                }
                
                const highTemp = parseTemperature(day.æœ€é«˜æ¸©);
                const lowTemp = parseTemperature(day.æœ€ä½æ¸©);
                
                if (highTemp !== null && lowTemp !== null) {
                    const avgTemp = (highTemp + lowTemp) / 2;
                    yearlyTemps[year].sum += avgTemp;
                    yearlyTemps[year].count++;
                }
            });
            
            const result = {};
            for (const [year, data] of Object.entries(yearlyTemps)) {
                if (data.count > 0) {
                    result[year] = data.sum / data.count;
                }
            }
            
            return result;
        }
        
        // è®¡ç®—å¤©æ°”æƒ…å†µåˆ†å¸ƒ
        function calculateWeatherDistribution(cityData) {
            const weatherCount = {};
            let totalDays = 0;
            
            cityData.data.forEach(day => {
                if (day.å¤©æ°”) {
                    // å¤„ç†å¤åˆå¤©æ°”æƒ…å†µï¼Œå¦‚"æ™´è½¬å¤šäº‘"
                    const weathers = day.å¤©æ°”.split(/è½¬|åˆ°|,/);
                    weathers.forEach(weather => {
                        const trimmedWeather = weather.trim();
                        if (trimmedWeather) {
                            weatherCount[trimmedWeather] = (weatherCount[trimmedWeather] || 0) + 1;
                            totalDays++;
                        }
                    });
                }
            });
            
            // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
            const result = {};
            for (const [weather, count] of Object.entries(weatherCount)) {
                result[weather] = (count / totalDays) * 100;
            }
            
            return result;
        }
        
        // æ¸²æŸ“æ¸©åº¦å›¾è¡¨
        function renderTemperatureChart() {
            // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„å…¶ä»–å›¾è¡¨
            chart.clear();
            
            // è·å–ç”¨æˆ·é€‰æ‹©çš„åŸå¸‚
            const selectedCityPinyins = getSelectedCities('temperature-city-checkbox');
            
            // å¦‚æœæ²¡æœ‰é€‰ä¸­ä»»ä½•åŸå¸‚ï¼Œä½¿ç”¨é»˜è®¤åŸå¸‚
            if (selectedCityPinyins.length === 0) {
                selectedCityPinyins.push(...defaultSelectedCities);
                // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
                defaultSelectedCities.forEach(city => {
                    const checkbox = document.getElementById(`temperature-city-checkbox-${city}`);
                    if (checkbox) checkbox.checked = true;
                });
                updateSelectionInfo('temperature-city-checkbox', 'temperature-selection-info');
            }
            
            const cityData = [];
            const temperatures = [];
            
            // ä»å†å²æ•°æ®ä¸­æå–é€‰å®šåŸå¸‚çš„æ¸©åº¦æ•°æ®
            selectedCityPinyins.forEach(cityPinyin => {
                if (historicalData[cityPinyin]) {
                    const cityInfo = historicalData[cityPinyin];
                    const yearlyTemps = calculateYearlyAverageTemperatures(cityInfo);
                    
                    // è·å–æœ€è¿‘ä¸€å¹´çš„æ¸©åº¦æ•°æ®
                    const years = Object.keys(yearlyTemps).sort();
                    if (years.length > 0) {
                        const latestYear = years[years.length - 1];
                        cityData.push({
                            name: cityInfo.name,
                            temperature: yearlyTemps[latestYear]
                        });
                    }
                }
            });
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const cityNames = cityData.map(item => item.name);
            const tempValues = cityData.map(item => item.temperature ? item.temperature.toFixed(1) : 0);
            
            const option = {
                title: {
                    text: 'åŸå¸‚å¹´å¹³å‡æ°”æ¸©',
                    left: 'center',
                    textStyle: {
                        color: '#5bc0de',
                        fontSize: 20
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        return `${params[0].name}<br/>å¹³å‡æ°”æ¸©: ${params[0].value}Â°C`;
                    },
                    backgroundColor: 'rgba(10, 25, 40, 0.9)',
                    borderColor: 'rgba(91, 192, 222, 0.5)',
                    textStyle: {
                        color: '#e0f0ff'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: cityNames,
                    axisLine: {
                        lineStyle: {
                            color: '#5bc0de'
                        }
                    },
                    axisLabel: {
                        color: '#aaccff',
                        interval: 0,
                        rotate: cityNames.length > 8 ? 45 : 0
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'æ¸©åº¦ Â°C',
                    nameTextStyle: {
                        color: '#aaccff'
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#5bc0de'
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(91, 192, 222, 0.1)'
                        }
                    },
                    axisLabel: {
                        color: '#aaccff',
                        formatter: '{value}Â°C'
                    }
                },
                series: [{
                    name: 'å¹´å¹³å‡æ°”æ¸©',
                    type: 'bar',
                    data: tempValues,
                    itemStyle: {
                        color: function(params) {
                            // æ ¹æ®æ¸©åº¦å€¼è®¾ç½®é¢œè‰²
                            const temp = params.value;
                            if (temp < 0) return '#313695';
                            if (temp < 10) return '#4575b4';
                            if (temp < 20) return '#74add1';
                            if (temp < 25) return '#abd9e9';
                            if (temp < 30) return '#ffffbf';
                            if (temp < 35) return '#fee090';
                            return '#f46d43';
                        }
                    },
                    label: {
                        show: true,
                        position: 'top',
                        color: '#e0f0ff',
                        formatter: '{c}Â°C'
                    }
                }]
            };
            
            chart.setOption(option);
            
            // æ›´æ–°è¯´æ˜æ–‡æœ¬
            document.getElementById('chart-instructions').innerHTML = `
                <p>ğŸ’¡ æç¤ºï¼šæ­¤å›¾è¡¨å±•ç¤ºäº†é€‰å®šåŸå¸‚çš„å¹´å¹³å‡æ°”æ¸©å¯¹æ¯”ã€‚</p>
                <p>ä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒçš„æ¸©åº¦èŒƒå›´ï¼Œæ¡å½¢é«˜åº¦è¡¨ç¤ºæ¸©åº¦æ•°å€¼ã€‚</p>
                <p>æ‚¨å¯ä»¥é€šè¿‡ä¸Šæ–¹çš„åŸå¸‚é€‰æ‹©å™¨æ·»åŠ æˆ–ç§»é™¤åŸå¸‚ã€‚</p>
            `;
        }
        
        // æ¸²æŸ“å¤©æ°”åˆ†å¸ƒå›¾è¡¨
        function renderWeatherChart() {
            // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„å…¶ä»–å›¾è¡¨
            chart.clear();
            
            // è·å–ç”¨æˆ·é€‰æ‹©çš„åŸå¸‚
            const selectedCityPinyins = getSelectedCities('weather-city-checkbox');
            
            // å¦‚æœæ²¡æœ‰é€‰ä¸­ä»»ä½•åŸå¸‚ï¼Œä½¿ç”¨é»˜è®¤åŸå¸‚
            if (selectedCityPinyins.length === 0) {
                selectedCityPinyins.push(...defaultSelectedCities);
                // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
                defaultSelectedCities.forEach(city => {
                    const checkbox = document.getElementById(`weather-city-checkbox-${city}`);
                    if (checkbox) checkbox.checked = true;
                });
                updateSelectionInfo('weather-city-checkbox', 'weather-selection-info');
            }
            
            // å¤„ç†æ•°æ®ï¼šè®¡ç®—æ¯ä¸ªåŸå¸‚çš„å¤©æ°”æƒ…å†µåˆ†å¸ƒ
            const cityWeatherData = {};
            
            selectedCityPinyins.forEach(cityPinyin => {
                if (historicalData[cityPinyin]) {
                    const weatherDistribution = calculateWeatherDistribution(historicalData[cityPinyin]);
                    cityWeatherData[historicalData[cityPinyin].name] = weatherDistribution;
                }
            });
            
            // è·å–æ‰€æœ‰å¤©æ°”ç±»å‹å¹¶æŒ‰å‡ºç°é¢‘ç‡æ’åº
            const allWeatherTypes = new Set();
            Object.values(cityWeatherData).forEach(distribution => {
                Object.keys(distribution).forEach(weather => {
                    allWeatherTypes.add(weather);
                });
            });
            
            // è®¡ç®—æ¯ç§å¤©æ°”ç±»å‹çš„æ€»å‡ºç°é¢‘ç‡
            const weatherFrequency = {};
            allWeatherTypes.forEach(weather => {
                weatherFrequency[weather] = 0;
                Object.values(cityWeatherData).forEach(distribution => {
                    weatherFrequency[weather] += distribution[weather] || 0;
                });
            });
            
            // æŒ‰é¢‘ç‡æ’åºå¹¶é€‰æ‹©å‰5ç§ä¸»è¦å¤©æ°”ç±»å‹
            const sortedWeatherTypes = Array.from(allWeatherTypes).sort((a, b) => {
                return weatherFrequency[b] - weatherFrequency[a];
            });
            
            const mainWeatherTypes = sortedWeatherTypes.slice(0, 5);
            mainWeatherTypes.push('å…¶ä»–'); // æ·»åŠ "å…¶ä»–"ç±»åˆ«
            
            // é‡ç»„æ•°æ®ï¼Œå°†éä¸»è¦å¤©æ°”ç±»å‹åˆå¹¶åˆ°"å…¶ä»–"
            const processedCityData = {};
            Object.entries(cityWeatherData).forEach(([city, distribution]) => {
                processedCityData[city] = {};
                let otherPercentage = 0;
                
                Object.entries(distribution).forEach(([weather, percentage]) => {
                    if (mainWeatherTypes.includes(weather)) {
                        processedCityData[city][weather] = percentage;
                    } else {
                        otherPercentage += percentage;
                    }
                });
                
                if (otherPercentage > 0) {
                    processedCityData[city]['å…¶ä»–'] = otherPercentage;
                }
                
                // ç¡®ä¿æ‰€æœ‰ä¸»è¦å¤©æ°”ç±»å‹éƒ½æœ‰å€¼ï¼ˆå³ä½¿ä¸º0ï¼‰
                mainWeatherTypes.forEach(weather => {
                    if (!processedCityData[city][weather]) {
                        processedCityData[city][weather] = 0;
                    }
                });
            });
            
            // è·å–åŸå¸‚åˆ—è¡¨
            const selectedCities = Object.keys(processedCityData);
            const seriesData = [];
            
            mainWeatherTypes.forEach(weather => {
                const data = selectedCities.map(city => {
                    return processedCityData[city][weather] || 0;
                });
                
                seriesData.push({
                    name: weather,
                    type: 'bar',
                    stack: 'æ€»é‡',
                    data: data,
                    emphasis: {
                        focus: 'series'
                    }
                });
            });
            
            const option = {
                title: {
                    text: 'åŸå¸‚å¤©æ°”æƒ…å†µåˆ†å¸ƒ',
                    left: 'center',
                    textStyle: {
                        color: '#5bc0de',
                        fontSize: 20
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        let total = 0;
                        
                        params.forEach(param => {
                            result += `${param.seriesName}: ${param.value.toFixed(1)}%<br/>`;
                            total += param.value;
                        });
                        
                        result += `<hr style="margin: 5px 0; border: none; border-top: 1px solid #ccc;"/>`;
                        result += `æ€»è®¡: ${total.toFixed(1)}%`;
                        
                        return result;
                    },
                    backgroundColor: 'rgba(10, 25, 40, 0.9)',
                    borderColor: 'rgba(91, 192, 222, 0.5)',
                    textStyle: {
                        color: '#e0f0ff'
                    }
                },
                legend: {
                    data: mainWeatherTypes,
                    textStyle: {
                        color: '#aaccff'
                    },
                    top: 50,
                    right: 10,
                    selectedMode: true,
                    type: 'scroll'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '25%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: selectedCities,
                    axisLine: {
                        lineStyle: {
                            color: '#5bc0de'
                        }
                    },
                    axisLabel: {
                        color: '#aaccff',
                        interval: 0,
                        rotate: selectedCities.length > 8 ? 45 : 0
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'å‡ºç°æ¦‚ç‡(%)',
                    nameTextStyle: {
                        color: '#aaccff'
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#5bc0de'
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(91, 192, 222, 0.1)'
                        }
                    },
                    axisLabel: {
                        color: '#aaccff',
                        formatter: '{value}%'
                    }
                },
                series: seriesData
            };
            
            chart.setOption(option);
            
            // æ›´æ–°è¯´æ˜æ–‡æœ¬
            document.getElementById('chart-instructions').innerHTML = `
                <p>ğŸ’¡ æç¤ºï¼šæ­¤å›¾è¡¨å±•ç¤ºäº†é€‰å®šåŸå¸‚çš„å¤©æ°”æƒ…å†µåˆ†å¸ƒã€‚</p>
                <p>ä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒçš„å¤©æ°”ç±»å‹ï¼Œå †å é«˜åº¦è¡¨ç¤ºè¯¥å¤©æ°”ç±»å‹çš„å‡ºç°æ¦‚ç‡ã€‚</p>
                <p>æ‚¨å¯ä»¥é€šè¿‡ä¸Šæ–¹çš„åŸå¸‚é€‰æ‹©å™¨æ·»åŠ æˆ–ç§»é™¤åŸå¸‚ã€‚</p>
            `;
        }
        
        // æ¸²æŸ“é£ç«ç‘°å›¾
        function renderWindRoseChart(city) {
            // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„å…¶ä»–å›¾è¡¨
            chart.clear();
            
            const windData = processWindData(city);
            
            // è®¾ç½®åŸå¸‚åç§°
            document.getElementById('city-name').textContent = capitalCities[city]?.name || 'æœªçŸ¥åŸå¸‚';
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const chartData = [];
            const frequencyData = [];
            
            directions.forEach(dir => {
                if (windData[dir]) {
                    chartData.push({
                        value: windData[dir].avgSpeed,
                        name: directionMap[dir]
                    });
                    frequencyData.push(windData[dir].frequency);
                } else {
                    // ç¡®ä¿æ‰€æœ‰æ–¹å‘éƒ½æœ‰æ•°æ®ï¼Œå³ä½¿ä¸º0
                    chartData.push({
                        value: 0,
                        name: directionMap[dir]
                    });
                    frequencyData.push(0);
                }
            });
            
            // æ–¹å‘æ˜ å°„ (è‹±æ–‡åˆ°ä¸­æ–‡)
            const directionMap = {
                'N': 'åŒ—',
                'NE': 'ä¸œåŒ—',
                'E': 'ä¸œ',
                'SE': 'ä¸œå—',
                'S': 'å—',
                'SW': 'è¥¿å—',
                'W': 'è¥¿',
                'NW': 'è¥¿åŒ—'
            };
            
            // é…ç½®é€‰é¡¹
            const option = {
                title: {
                    text: 'é£é€Ÿä¸é£å‘åˆ†å¸ƒ',
                    left: 'center',
                    textStyle: {
                        color: '#5bc0de',
                        fontSize: 20
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        const index = params.dataIndex;
                        return `${params.name}é£<br/>å¹³å‡é£é€Ÿ: ${params.value.toFixed(1)} km/h<br/>å‡ºç°é¢‘ç‡: ${frequencyData[index].toFixed(1)}%`;
                    },
                    backgroundColor: 'rgba(10, 25, 40, 0.9)',
                    borderColor: 'rgba(91, 192, 222, 0.5)',
                    textStyle: {
                        color: '#e0f0ff'
                    }
                },
                legend: {
                    orient: 'horizontal',
                    bottom: 10,
                    data: Object.values(directionMap),
                    textStyle: {
                        color: '#aaccff'
                    }
                },
                polar: {
                    radius: '70%'
                },
                angleAxis: {
                    type: 'category',
                    data: Object.values(directionMap),
                    startAngle: 90,
                    axisLine: {
                        lineStyle: {
                            color: '#5bc0de'
                        }
                    },
                    axisLabel: {
                        color: '#aaccff',
                        fontSize: 14
                    }
                },
                radiusAxis: {
                    min: 0,
                    axisLine: {
                        lineStyle: {
                            color: '#5bc0de'
                        }
                    },
                    axisLabel: {
                        color: '#aaccff',
                        formatter: '{value} km/h'
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(91, 192, 222, 0.2)'
                        }
                    }
                },
                series: [{
                    type: 'bar',
                    coordinateSystem: 'polar',
                    data: chartData,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    itemStyle: {
                        color: function(params) {
                            // æ ¹æ®é¢‘ç‡è®¾ç½®é¢œè‰²
                            const frequency = frequencyData[params.dataIndex];
                            if (frequency < 5) return '#74add1';
                            if (frequency < 10) return '#abd9e9';
                            if (frequency < 15) return '#fee090';
                            if (frequency < 20) return '#fdae61';
                            return '#f46d43';
                        }
                    },
                    label: {
                        show: true,
                        position: 'middle',
                        formatter: '{b}',
                        color: '#fff',
                        fontWeight: 'bold'
                    }
                }]
            };
            
            // è®¾ç½®é€‰é¡¹å¹¶æ¸²æŸ“å›¾è¡¨
            chart.setOption(option);
            
            // æ›´æ–°è¯´æ˜æ–‡æœ¬
            document.getElementById('chart-instructions').innerHTML = `
                <p>ğŸ’¡ æç¤ºï¼šç«ç‘°å›¾å±•ç¤ºäº†å…«ä¸ªä¸»è¦æ–¹å‘ï¼ˆåŒ—ã€ä¸œåŒ—ã€ä¸œã€ä¸œå—ã€å—ã€è¥¿å—ã€è¥¿ã€è¥¿åŒ—ï¼‰çš„é£é€Ÿå’Œé£å‘åˆ†å¸ƒæƒ…å†µã€‚</p>
                <p>æ¡å½¢é•¿åº¦è¡¨ç¤ºå¹³å‡é£é€Ÿï¼Œé¢œè‰²è¡¨ç¤ºå‡ºç°é¢‘ç‡ã€‚</p>
            `;
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            // ç”ŸæˆåŸå¸‚é€‰æ‹©å™¨
            generateCityCheckboxes('temperature-city-checkbox', 'temperature-selection-info');
            generateCityCheckboxes('weather-city-checkbox', 'weather-selection-info');
            generateWindCitySelect();
            
            // è·å–å½“å‰å›¾è¡¨ç±»å‹
            const chartType = getParamFromURL('chart') || 'wind';
            
            // è®¾ç½®ä¸‹æ‹‰èœå•é»˜è®¤å€¼
            const chartTypeSelect = document.getElementById('chart-type-select');
            if (chartTypeSelect) {
                chartTypeSelect.value = chartType;
                
                // æ·»åŠ å›¾è¡¨ç±»å‹åˆ‡æ¢äº‹ä»¶
                chartTypeSelect.addEventListener('change', function() {
                    // æ›´æ–°URLå‚æ•°ä½†ä¸åˆ·æ–°é¡µé¢
                    const newUrl = new URL(window.location);
                    newUrl.searchParams.set('chart', this.value);
                    window.history.replaceState({}, '', newUrl);
                    
                    // é‡æ–°åˆå§‹åŒ–å›¾è¡¨
                    initChart();
                });
            }
            
            // è®¾ç½®åŸå¸‚é€‰æ‹©å™¨é»˜è®¤å€¼
            const windCitySelect = document.getElementById('wind-city-select');
            if (windCitySelect) {
                // æ·»åŠ åŸå¸‚åˆ‡æ¢äº‹ä»¶
                windCitySelect.addEventListener('change', function() {
                    if (document.getElementById('chart-type-select').value === 'wind') {
                        renderWindRoseChart(this.value);
                    }
                });
            }
            
            // åŠ è½½å†å²æ•°æ®å¹¶åˆå§‹åŒ–å›¾è¡¨
            loadHistoricalData();
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const chartType = getParamFromURL('chart') || 'wind';
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œæè¿°
            const titles = {
                'temperature': 'å¹´å¹³å‡æ°”æ¸©åˆ†æ',
                'weather': 'å¤©æ°”æƒ…å†µåˆ†å¸ƒåˆ†æ',
                'wind': 'é£é€Ÿä¸é£å‘ç«ç‘°å›¾'
            };
            
            const descriptions = {
                'temperature': 'å±•ç¤ºä¸»è¦åŸå¸‚å¹´å¹³å‡æ°”æ¸©å¯¹æ¯”',
                'weather': 'å±•ç¤ºå…¨å›½å„åœ°å¤©æ°”æƒ…å†µåˆ†å¸ƒ',
                'wind': 'å±•ç¤ºå…«æ–¹å‘é£é€Ÿä¸é£å‘åˆ†å¸ƒæƒ…å†µ'
            };
            
            document.getElementById('page-title').textContent = titles[chartType];
            document.getElementById('page-description').textContent = descriptions[chartType];
            
            // æ ¹æ®å›¾è¡¨ç±»å‹æ˜¾ç¤º/éšè—åŸå¸‚é€‰æ‹©å™¨
            const windCitySelector = document.getElementById('wind-city-selector');
            const tempCitySelector = document.getElementById('temperature-city-selector');
            const weatherCitySelector = document.getElementById('weather-city-selector');
            
            if (windCitySelector && tempCitySelector && weatherCitySelector) {
                if (chartType === 'wind') {
                    windCitySelector.style.display = 'block';
                    tempCitySelector.style.display = 'none';
                    weatherCitySelector.style.display = 'none';
                } else if (chartType === 'temperature') {
                    windCitySelector.style.display = 'none';
                    tempCitySelector.style.display = 'block';
                    weatherCitySelector.style.display = 'none';
                } else if (chartType === 'weather') {
                    windCitySelector.style.display = 'none';
                    tempCitySelector.style.display = 'none';
                    weatherCitySelector.style.display = 'block';
                }
            }
            
            // æ ¹æ®å›¾è¡¨ç±»å‹æ¸²æŸ“ä¸åŒçš„å›¾è¡¨
            if (chartType === 'temperature') {
                renderTemperatureChart();
            } else if (chartType === 'weather') {
                renderWeatherChart();
            } else {
                // é»˜è®¤æ˜¾ç¤ºé£ç«ç‘°å›¾
                const city = getParamFromURL('city') || 'beijing';
                const citySelect = document.getElementById('wind-city-select');
                if (citySelect) {
                    citySelect.value = city;
                }
                renderWindRoseChart(city);
            }
            
            // ç§»é™¤åŠ è½½æç¤º
            const loadingElement = chartDom.querySelector('.loading');
            if (loadingElement) {
                loadingElement.remove();
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        initPage();
        
        // å“åº”çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', function() {
            chart.resize();
        });
    </script>
</body>
</html>