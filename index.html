<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>气象数据可视化平台 - 风场地图</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
		<style>
			:root {
				/* 颜色变量 */
				--primary-bg: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
				--header-bg: rgba(10, 30, 50, 0.85);
				--card-bg: rgba(30, 50, 70, 0.5);
				--card-hover-bg: rgba(30, 50, 70, 0.7);
				--primary-blue: #5bc0de;
				--light-blue: #9be6ff;
				--text-color: #e0e7ff;
				--text-secondary: #aaccff;
				--accent-yellow: #ffcc00;
				--success-green: #4CAF50;
				--error-red: #ff6b6b;

				/* 尺寸变量 */
				--border-radius: 15px;
				--card-padding: 2rem;
				--section-spacing: 4rem;
				--header-height: 70px;
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
				font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
			}

			body {
				background: var(--primary-bg);
				color: var(--text-color);
				line-height: 1.6;
				min-height: 100vh;
				overflow-x: hidden;
			}

			/* 头部样式 */
			header {
				background: var(--header-bg);
				color: white;
				padding: 1rem 0;
				box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
				backdrop-filter: blur(10px);
				position: sticky;
				top: 0;
				z-index: 1000;
			}

			.container {
				width: 90%;
				max-width: 1400px;
				margin: 0 auto;
			}

			.header-content {
				display: flex;
				justify-content: space-between;
				align-items: center;
				flex-wrap: wrap;
				gap: 1rem;
			}

			.logo {
				display: flex;
				align-items: center;
				gap: 12px;
				font-size: 1.8rem;
				font-weight: bold;
				color: var(--primary-blue);
			}

			.logo-icon {
				font-size: 2.2rem;
				animation: pulse 2s infinite;
			}

			@keyframes pulse {

				0%,
				100% {
					transform: scale(1);
				}

				50% {
					transform: scale(1.1);
				}
			}

			/* 导航样式 */
			nav ul {
				display: flex;
				list-style: none;
				gap: 1.5rem;
				flex-wrap: wrap;
				justify-content: center;
			}

			nav ul li a {
				color: var(--text-secondary);
				text-decoration: none;
				font-weight: 500;
				padding: 8px 15px;
				border-radius: 20px;
				transition: all 0.3s;
				position: relative;
				display: inline-block;
			}

			nav ul li a:hover,
			nav ul li a.active {
				background: rgba(91, 192, 222, 0.2);
				color: var(--primary-blue);
			}

			nav ul li a::after {
				content: '';
				position: absolute;
				bottom: -5px;
				left: 50%;
				width: 0;
				height: 3px;
				background: var(--primary-blue);
				border-radius: 2px;
				transform: translateX(-50%);
				transition: width 0.3s;
			}

			nav ul li a:hover::after {
				width: 70%;
			}

			/* 搜索栏样式 */
			.search-bar {
				margin: 1.5rem auto;
				display: flex;
				max-width: 600px;
			}

			.search-bar input {
				flex: 1;
				padding: 0.9rem 1.2rem;
				border: none;
				border-radius: 30px 0 0 30px;
				font-size: 1.05rem;
				background: rgba(255, 255, 255, 0.1);
				color: white;
				border: 1px solid rgba(91, 192, 222, 0.3);
				border-right: none;
			}

			.search-bar input::placeholder {
				color: var(--text-secondary);
			}

			.search-bar button {
				padding: 0.9rem 1.8rem;
				background: linear-gradient(90deg, var(--primary-blue), #4a90e2);
				border: none;
				border-radius: 0 30px 30px 0;
				cursor: pointer;
				font-weight: bold;
				color: white;
				transition: all 0.3s;
			}

			.search-bar button:hover {
				background: linear-gradient(90deg, #4a90e2, var(--primary-blue));
				box-shadow: 0 0 15px rgba(91, 192, 222, 0.5);
			}

			.search-container {
				position: relative;
				margin: 1.5rem auto;
				display: flex;
				max-width: 600px;
				align-items: center;
			}

			.search-reset {
				margin-left: 10px;
				padding: 0.8rem 1.2rem;
				background: linear-gradient(90deg, #ff6b6b, #ff8787);
				border: none;
				border-radius: 30px;
				cursor: pointer;
				font-weight: bold;
				color: white;
				transition: all 0.3s;
				display: none;
			}

			.search-reset:hover {
				background: linear-gradient(90deg, #ff8787, #ff6b6b);
				box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
			}

			.search-suggestions {
				position: absolute;
				top: 100%;
				left: 0;
				right: 0;
				background: rgba(30, 50, 70, 0.95);
				border-radius: 0 0 15px 15px;
				max-height: 200px;
				overflow-y: auto;
				z-index: 1000;
				display: none;
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
			}

			.search-suggestion-item {
				padding: 10px 15px;
				cursor: pointer;
				transition: background 0.2s;
				color: #e0e7ff;
			}

			.search-suggestion-item:hover {
				background: rgba(91, 192, 222, 0.3);
			}

			/* 主横幅区域 */
			.hero {
				height: 500px;
				display: flex;
				align-items: center;
				color: white;
				text-align: center;
				position: relative;
				overflow: hidden;
				margin-top: 20px;
				border-radius: var(--border-radius);
				background: linear-gradient(135deg, rgba(15, 32, 39, 0.8), rgba(44, 83, 100, 0.6)),
					radial-gradient(circle at center, rgba(91, 192, 222, 0.2), transparent 70%);
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
			}

			.hero-content {
				position: relative;
				z-index: 1;
				width: 100%;
				padding: 0 20px;
			}

			.hero h1 {
				font-size: 3.2rem;
				margin-bottom: 1.5rem;
				text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
				background: linear-gradient(to right, var(--primary-blue), var(--light-blue));
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
			}

			.hero p {
				font-size: 1.4rem;
				max-width: 800px;
				margin: 0 auto 3rem;
				font-weight: 300;
				color: #e0f7ff;
			}

			/* 按钮样式 */
			.btn {
				display: inline-block;
				padding: 1rem 2.2rem;
				background: linear-gradient(90deg, var(--primary-blue), #4a90e2);
				color: white;
				text-decoration: none;
				borderRadius: 30px;
				font-weight: bold;
				font-size: 1.1rem;
				transition: all 0.3s;
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
				border: none;
				cursor: pointer;
			}

			.btn:hover {
				transform: translateY(-3px);
				box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
				background: linear-gradient(90deg, #4a90e2, var(--primary-blue));
			}

			/* 通用卡片样式 */
			.card {
				background: var(--card-bg);
				border-radius: var(--border-radius);
				padding: var(--card-padding);
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
				transition: all 0.4s;
				backdrop-filter: blur(10px);
				border: 1px solid rgba(91, 192, 222, 0.2);
			}

			.card:hover {
				transform: translateY(-10px);
				box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
				border-color: rgba(91, 192, 222, 0.4);
				background: var(--card-hover-bg);
			}

			/* 特性区域 */
			.features {
				padding: var(--section-spacing) 0;
			}

			.section-title {
				text-align: center;
				margin-bottom: 3rem;
			}

			.section-title h2 {
				font-size: 2.5rem;
				color: var(--primary-blue);
				margin-bottom: 1rem;
				position: relative;
				display: inline-block;
			}

			.section-title h2::after {
				content: '';
				position: absolute;
				bottom: -10px;
				left: 50%;
				transform: translateX(-50%);
				width: 100px;
				height: 4px;
				background: linear-gradient(90deg, var(--primary-blue), #4a90e2);
				border-radius: 2px;
			}

			.section-title p {
				color: var(--text-secondary);
				max-width: 700px;
				margin: 0 auto;
				font-size: 1.2rem;
			}

			.features-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
				gap: 2rem;
			}

			.feature-card {
				composes: card;
				display: flex;
				flex-direction: column;
				height: 100%;
			}

			.feature-icon {
				font-size: 3.5rem;
				margin-bottom: 1.5rem;
				text-align: center;
				color: var(--primary-blue);
			}

			.feature-card h3 {
				margin-bottom: 1.2rem;
				color: var(--primary-blue);
				font-size: 1.8rem;
				text-align: center;
				position: relative;
			}

			.feature-card p {
				color: #cce0ff;
				flex-grow: 1;
				font-size: 1.1rem;
				line-height: 1.8;
			}

			.feature-card .tech-list {
				margin-top: 1.5rem;
				display: flex;
				flex-wrap: wrap;
				gap: 8px;
			}

			.feature-card .tech-tag {
				background: rgba(91, 192, 222, 0.2);
				color: var(--primary-blue);
				padding: 5px 12px;
				border-radius: 15px;
				font-size: 0.85rem;
			}

			/* 地图容器 */
			.windy-map-container {
				position: relative;
				height: 700px;
				border-radius: var(--border-radius);
				overflow: hidden;
				box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
				border: 1px solid rgba(91, 192, 222, 0.3);
				background: rgba(10, 25, 40, 0.2);
				margin: 25px 0;
			}

			.windy-map-container::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: radial-gradient(circle at center, rgba(91, 192, 222, 0.1) 0%, transparent 70%);
				pointer-events: none;
				z-index: 0;
			}

			#windy-map {
				width: 100%;
				height: 100%;
			}

			/* 地图控件样式 */
			.map-control {
				background: rgba(15, 40, 65, 0.9);
				padding: 10px 15px;
				border-radius: 20px;
				z-index: 20;
				backdrop-filter: blur(5px);
				border: 1px solid rgba(91, 192, 222, 0.3);
				color: var(--light-blue);
			}

			.windy-legend,
			.windy-info-panel {
				composes: map-control;
				position: absolute;
				bottom: 30px;
				min-width: 200px;
			}

			.windy-legend {
				left: 30px;
			}

			.windy-info-panel {
				right: 30px;
				min-width: 250px;
			}

			.legend-title {
				color: var(--primary-blue);
				margin-bottom: 10px;
				text-align: center;
				font-weight: 600;
			}

			.legend-scale {
				height: 20px;
				background: linear-gradient(to right, #00a0ff, #00d4ff, #2ae0c8, #80ff72, #f9f871, #ffb978, #ff7b7b, #ff3e3e);
				border-radius: 5px;
				margin-bottom: 10px;
			}

			.legend-labels {
				display: flex;
				justify-content: space-between;
				font-size: 0.85rem;
				color: var(--text-secondary);
			}

			.info-title {
				color: var(--primary-blue);
				font-weight: 600;
				margin-bottom: 10px;
				display: flex;
				align-items: center;
				gap: 10px;
			}

			.info-content {
				display: grid;
				grid-template-columns: auto auto;
				gap: 8px 15px;
				font-size: 0.9rem;
			}

			.info-label {
				color: var(--light-blue);
				font-weight: 500;
			}

			.info-value {
				color: var(--accent-yellow);
				font-weight: 600;
				text-align: right;
			}

			.map-tips {
				composes: map-control;
				position: absolute;
				top: 20px;
				left: 50%;
				transform: translateX(-50%);
				font-size: 0.9rem;
			}

			.time-controls {
				composes: map-control;
				position: absolute;
				top: 20px;
				right: 20px;
				display: flex;
				gap: 10px;
				align-items: center;
			}

			.time-btn {
				background: transparent;
				border: none;
				color: var(--light-blue);
				font-size: 1.2rem;
				cursor: pointer;
				padding: 5px;
				border-radius: 50%;
				width: 30px;
				height: 30px;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: background 0.3s;
			}

			.time-btn:hover {
				background: rgba(91, 192, 222, 0.3);
			}

			.time-display {
				color: var(--accent-yellow);
				font-weight: 600;
				min-width: 120px;
				text-align: center;
				padding: 0 10px;
				font-size: 0.9rem;
			}

			.loading-overlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(10, 25, 40, 0.8);
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				z-index: 100;
				color: var(--primary-blue);
				font-size: 1.5rem;
				gap: 20px;
				transition: opacity 0.5s;
			}

			.spinner {
				width: 50px;
				height: 50px;
				border: 5px solid rgba(91, 192, 222, 0.3);
				border-top: 5px solid var(--primary-blue);
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}

				100% {
					transform: rotate(360deg);
				}
			}

			/* 城市天气区域 */
			.city-weather {
				padding: 4rem 0;
			}

			.city-weather-container {
				position: relative;
				overflow-x: auto;
				overflow-y: hidden;
				padding: 10px 0 30px;
				scroll-behavior: smooth;
				width: 100%;
				/* 显示自定义滚动条 */
				scrollbar-width: thin;
				scrollbar-color: var(--primary-blue) rgba(91, 192, 222, 0.2);
			}

			/* 自定义滚动条样式 - Webkit浏览器 */
			.city-weather-container::-webkit-scrollbar {
				height: 8px;
			}

			.city-weather-container::-webkit-scrollbar-track {
				background: rgba(91, 192, 222, 0.2);
				border-radius: 4px;
			}

			.city-weather-container::-webkit-scrollbar-thumb {
				background: var(--primary-blue);
				border-radius: 4px;
			}

			.city-weather-container::-webkit-scrollbar-thumb:hover {
				background: var(--light-blue);
			}

			.city-grid {
				display: flex;
				gap: 1.5rem;
				padding: 10px 20px;
				width: max-content;
			}

			.city-card {
				background: rgba(30, 50, 70, 0.5);
				border-radius: 15px;
				overflow: hidden;
				min-height: 320px;
				width: 240px;
				/* 减小卡片宽度 */
				flex: 0 0 auto;
				transition: all 0.3s ease;
				backdrop-filter: blur(10px);
				border: 1px solid rgba(91, 192, 222, 0.2);
			}

			.city-card:hover {
				transform: translateY(-5px);
				box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
				border-color: rgba(91, 192, 222, 0.4);
				background: rgba(30, 50, 70, 0.7);
			}

			.city-header {
				background: linear-gradient(90deg, #1e5799, #207cca);
				color: white;
				padding: 1rem;
				text-align: center;
				position: relative;
			}

			.city-header h3 {
				font-size: 1.4rem;
				margin-bottom: 5px;
				color: white;
			}

			.city-header p {
				font-size: 0.8rem;
				opacity: 0.9;
			}

			.city-content {
				padding: 1.2rem;
				text-align: center;
			}

			/* 导航按钮 */
			.nav-button {
				position: absolute;
				top: 50%;
				transform: translateY(-50%);
				width: 40px;
				height: 40px;
				background: rgba(30, 50, 70, 0.8);
				border: none;
				border-radius: 50%;
				color: var(--primary-blue);
				font-size: 1.2rem;
				cursor: pointer;
				z-index: 10;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.3s;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
			}

			.nav-button:hover {
				background: var(--primary-blue);
				color: white;
				transform: translateY(-50%) scale(1.1);
			}

			.nav-button.prev {
				left: 10px;
			}

			.nav-button.next {
				right: 10px;
			}

			.weather-icon {
				font-size: 2.5rem;
				margin: 0.8rem 0;
				color: #ffcc00;
				text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			}

			.temp {
				font-size: 1.8rem;
				font-weight: bold;
				margin-bottom: 0.8rem;
				color: #ffcc00;
			}

			.city-content p {
				margin: 6px 0;
				color: #cce0ff;
				font-size: 0.9rem;
				display: flex;
				justify-content: space-between;
			}

			.air-quality {
				margin-top: 12px;
				padding: 8px;
				background: rgba(91, 192, 222, 0.1);
				border-radius: 8px;
			}

			.aqi-value {
				font-size: 1.2rem;
				font-weight: bold;
				margin-bottom: 5px;
			}

			.pm-value {
				font-size: 0.8rem;
			}

			.nav-button,
			.city-indicators {
				display: none;
			}

			/* 自定义滚动条样式 */
			.scroll-indicator {
				position: relative;
				height: 6px;
				background: rgba(91, 192, 222, 0.2);
				border-radius: 3px;
				margin: 10px auto 0;
				max-width: 400px;
				overflow: hidden;
			}

			.scroll-progress {
				height: 100%;
				width: 0%;
				background: var(--primary-blue);
				border-radius: 3px;
				transition: width 0.3s ease;
			}

			/* 添加滚动提示 */
			.scroll-hint {
				text-align: center;
				color: var(--text-secondary);
				font-size: 0.9rem;
				margin-top: 5px;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 5px;
			}

			.city-indicators {
				display: flex;
				justify-content: center;
				margin-top: 20px;
				gap: 10px;
			}

			.indicator {
				width: 10px;
				height: 10px;
				border-radius: 50%;
				background: rgba(91, 192, 222, 0.3);
				cursor: pointer;
				transition: all 0.3s;
			}

			.indicator.active {
				background: var(--primary-blue);
				transform: scale(1.2);
			}

			/* 数据部分样式 */
			.data-section {
				padding: var(--section-spacing) 0;
			}

			.data-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
				gap: 2rem;
				margin-top: 2rem;
			}

			.data-card {
				composes: card;
			}

			.data-card h3 {
				color: var(--primary-blue);
				margin-bottom: 1.5rem;
				font-size: 1.5rem;
				text-align: center;
			}

			.data-chart {
				height: 300px;
			}

			.data-status {
				text-align: center;
				padding: 20px;
				color: var(--text-secondary);
				font-size: 1.1rem;
			}

			.retry-button {
				margin-top: 15px;
				padding: 8px 20px;
				background: linear-gradient(90deg, var(--primary-blue), #4a90e2);
				color: white;
				border: none;
				border-radius: 20px;
				cursor: pointer;
				font-weight: 500;
				transition: all 0.3s;
			}

			.retry-button:hover {
				background: linear-gradient(90deg, #4a90e2, var(--primary-blue));
				transform: translateY(-2px);
			}

			/* 库信息部分 */
			.lib-info {
				background: rgba(20, 40, 60, 0.88);
				border-radius: var(--border-radius);
				padding: 30px;
				margin-top: 30px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
				border: 1px solid rgba(91, 192, 222, 0.25);
				position: relative;
			}

			.lib-info::after {
				content: '';
				position: absolute;
				top: -10px;
				left: 50%;
				transform: translateX(-50%);
				width: 60%;
				height: 4px;
				background: linear-gradient(90deg, transparent, var(--primary-blue), transparent);
				border-radius: 2px;
			}

			.lib-info h2 {
				color: var(--primary-blue);
				margin-bottom: 25px;
				text-align: center;
				font-size: 2.2rem;
				text-shadow: 0 0 10px rgba(91, 192, 222, 0.4);
				position: relative;
				padding-bottom: 15px;
			}

			.lib-info h2::after {
				content: '';
				position: absolute;
				bottom: 0;
				left: 50%;
				transform: translateX(-50%);
				width: 100px;
				height: 3px;
				background: linear-gradient(90deg, var(--primary-blue), #4a90e2);
				border-radius: 2px;
			}

			.dependencies-info {
				background: rgba(25, 50, 75, 0.7);
				padding: 25px;
				border-radius: 12px;
				margin-bottom: 30px;
				position: relative;
			}

			.dependencies-info h3 {
				color: var(--accent-yellow);
				margin-bottom: 20px;
				font-size: 1.5rem;
				text-align: center;
			}

			.dependency-list {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
				gap: 20px;
			}

			.dependency-item {
				background: rgba(15, 35, 55, 0.8);
				padding: 15px;
				border-radius: 10px;
				border-left: 3px solid var(--primary-blue);
				color: #d0e8ff;
			}

			.dependency-item h4 {
				color: var(--primary-blue);
				margin-bottom: 10px;
			}

			.dependency-item p {
				color: #d0e8ff;
				line-height: 1.7;
			}

			.dependency-item .local-file-status {
				display: block;
				margin-top: 10px;
				padding: 8px;
				background: rgba(91, 192, 222, 0.1);
				border-radius: 5px;
				color: #aaffaa;
				font-size: 0.9rem;
			}

			/* 页脚样式 */
			footer {
				background: rgba(10, 25, 40, 0.9);
				color: var(--text-secondary);
				padding: 3rem 0 1.5rem;
				text-align: center;
				margin-top: 4rem;
				border-top: 1px solid rgba(91, 192, 222, 0.2);
			}

			.footer-links {
				display: flex;
				justify-content: center;
				margin-bottom: 2rem;
				flex-wrap: wrap;
				gap: 1.5rem;
			}

			.footer-links a {
				color: var(--primary-blue);
				text-decoration: none;
				transition: all 0.3s;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.footer-links a:hover {
				color: var(--light-blue);
				transform: translateY(-2px);
			}

			footer p {
				margin: 8px 0;
				font-size: 0.95rem;
				opacity: 0.8;
			}

			.social-icons {
				display: flex;
				justify-content: center;
				gap: 20px;
				margin: 1.5rem 0;
			}

			.social-icon {
				width: 45px;
				height: 45px;
				border-radius: 50%;
				background: rgba(91, 192, 222, 0.2);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1.3rem;
				color: var(--primary-blue);
				transition: all 0.3s;
			}

			.social-icon:hover {
				background: var(--primary-blue);
				color: white;
				transform: translateY(-5px);
			}

			/* 状态栏 */
			.status-bar {
				position: fixed;
				bottom: 20px;
				left: 50%;
				transform: translateX(-50%);
				background: rgba(15, 40, 65, 0.9);
				padding: 12px 25px;
				border-radius: 30px;
				font-size: 1.1rem;
				color: var(--primary-blue);
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
				backdrop-filter: blur(10px);
				border: 1px solid rgba(91, 192, 222, 0.3);
				z-index: 1000;
				display: flex;
				align-items: center;
				gap: 10px;
			}

			.status-indicator {
				width: 12px;
				height: 12px;
				border-radius: 50%;
				background: var(--success-green);
				box-shadow: 0 0 10px var(--success-green);
				animation: pulse-status 1.5s infinite;
			}

			@keyframes pulse-status {

				0%,
				100% {
					opacity: 0.6;
				}

				50% {
					opacity: 1;
				}
			}

			/* 辅助类 */
			.clickable-chart {
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.clickable-chart:hover {
				box-shadow: 0 0 20px rgba(91, 192, 222, 0.5);
			}

			.chart-title-with-link {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.view-all-link {
				font-size: 0.9rem;
				color: var(--light-blue);
				text-decoration: none;
				display: flex;
				align-items: center;
				gap: 5px;
			}

			.view-all-link:hover {
				color: var(--primary-blue);
				text-decoration: underline;
			}

			.error-message {
				background: rgba(200, 0, 0, 0.2);
				border: 1px solid rgba(255, 0, 0, 0.3);
				border-radius: 5px;
				padding: 10px;
				margin: 10px 0;
				color: var(--error-red);
			}

			.wind-rose-title {
				text-align: center;
				color: var(--primary-blue);
				margin-top: 10px;
				font-size: 1.2rem;
				font-weight: bold;
			}

			.search-results {
				margin-top: 1rem;
				text-align: center;
			}

			.no-results {
				color: var(--error-red);
				padding: 1rem;
				background: rgba(255, 107, 107, 0.1);
				border-radius: 8px;
				margin-top: 1rem;
			}

			.highlight-card {
				animation: highlight 2s ease;
				box-shadow: 0 0 20px rgba(91, 192, 222, 0.7) !important;
			}

			@keyframes highlight {

				0%,
				100% {
					transform: scale(1);
				}

				50% {
					transform: scale(1.03);
				}
			}

			/* 响应式设计 */
			@media (max-width: 1200px) {
				.city-card {
					flex: 0 0 calc(33.333% - 2rem);
				}
			}

			@media (max-width: 900px) {
				.city-card {
					flex: 0 0 calc(50% - 2rem);
				}

				.windy-map-container {
					height: 500px;
				}

				.time-controls {
					gap: 8px;
				}

				.data-grid {
					grid-template-columns: 1fr;
				}
			}

			@media (max-width: 768px) {
				.city-card {
					width: 220px;
					min-height: 300px;
				}

				.city-grid {
					gap: 1rem;
				}

				.header-content {
					flex-direction: column;
					text-align: center;
				}

				.hero h1 {
					font-size: 2.2rem;
				}

				.hero p {
					font-size: 1.1rem;
				}

				.windy-legend,
				.windy-info-panel {
					position: relative;
					bottom: auto;
					left: auto;
					right: auto;
					width: 100%;
					margin: 15px 0;
				}
			}

			@media (max-width: 600px) {
				.city-card {
					flex: 0 0 calc(100% - 2rem);
				}

				.nav-button {
					width: 35px;
					height: 35px;
				}

				.city-header {
					padding: 1.5rem;
				}

				.city-header h3 {
					font-size: 1.8rem;
				}

				.city-content {
					padding: 1.8rem;
				}

				.weather-icon {
					font-size: 3.5rem;
				}

				.temp {
					font-size: 2.5rem;
				}

				.city-content p {
					font-size: 1.1rem;
				}

				.windy-map-container {
					height: 400px;
				}
			}

			@keyframes pulse-status {
				0% {
					opacity: 0.6;
				}

				50% {
					opacity: 1;
				}

				100% {
					opacity: 0.6;
				}
			}

			@media (max-width: 900px) {
				.windy-map-container {
					height: 500px;
				}

				.time-controls {
					gap: 8px;
				}

				.data-grid {
					grid-template-columns: 1fr;
				}
			}

			@media (max-width: 768px) {
				.header-content {
					flex-direction: column;
					text-align: center;
					gap: 1rem;
				}

				nav ul {
					justify-content: center;
					flex-wrap: wrap;
				}

				.hero h1 {
					font-size: 2.2rem;
				}

				.hero p {
					font-size: 1.1rem;
				}

				.windy-legend,
				.windy-info-panel {
					position: relative;
					bottom: auto;
					left: auto;
					right: auto;
					width: 100%;
					margin: 15px 0;
				}

				.nav-button {
					display: none;
				}

				/* 移动设备上显示滚动提示 */
				.scroll-hint {
					display: flex;
				}
			}

			@media (max-width: 500px) {
				.windy-map-container {
					height: 400px;
				}
			}

			@media (max-width: 480px) {
				.city-card {
					width: 200px;
					min-height: 280px;
				}

				.city-content {
					padding: 1rem;
				}

				.temp {
					font-size: 1.6rem;
				}
			}

			@keyframes highlight {
				0% {
					transform: scale(1);
				}

				50% {
					transform: scale(1.03);
				}

				100% {
					transform: scale(1);
				}
			}
		</style>
	</head>
	<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">🌪️</span>
                    <span>气象数据可视化平台</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="active">首页</a></li>
                        <li><a href="#city-weather">实时天气</a></li>
                        <li><a href="#wind-map-section">气象地图</a></li>
                        <li><a href="#data-section">数据分析</a></li>
                    </ul>
                </nav>
            </div>
            <div class="search-bar">
                <input type="text" id="city-search-input" placeholder="输入城市名称查询实时天气...">
                <button id="search-button">搜索</button>
            </div>
            <button class="search-reset" id="reset-button">复位</button>
            <div class="search-suggestions" id="search-suggestions"></div>
            <div class="search-results" id="search-results"></div>
        </div>
    </header>

		<section class="hero">
			<div class="hero-content">
				<h1>全国气象数据可视化分析平台</h1>
				<p>基于ECharts与GL技术的高级气象可视化系统，提供精准的天气数据、动态风场展示与深度气候分析</p>
				<a href="#wind-map-section" class="btn">探索实时气象地图</a>
			</div>
		</section>
		<section class="city-weather" id="city-weather">
			<div class="container">
				<div class="section-title">
					<h2>主要城市实时天气</h2>
					<p>全国重点城市气象数据监测与分析</p>
				</div>

				<div class="city-weather-wrapper">
					<button class="nav-button prev" id="prev-button">
						<i class="fas fa-chevron-left"></i>
					</button>

					<div class="city-weather-container">
						<div class="city-grid" id="city-cards-container">
						</div>
					</div>

					<button class="nav-button next" id="next-button">
						<i class="fas fa-chevron-right"></i>
					</button>
				</div>

				<div class="scroll-indicator">
					<div class="scroll-progress" id="scroll-progress"></div>
				</div>
				<div class="scroll-hint">
					<i class="fas fa-info-circle"></i> 左右滑动查看所有城市
				</div>
			</div>
		</section>

<section class="weather-map-section" id="wind-map-section">
  <div class="container">
    <div class="section-title">
      <h2>全国主要城市实时天气地图</h2>
    </div>

    <!-- 地图图片 -->
    <div style="text-align: center; margin-top: 20px;">
      <img src="libs/china-map.png" alt="中国地图" style="width: 100%; max-width: 800px; border: 1px solid #ccc; border-radius: 6px;">
    </div>

    <!-- 查看详细按钮 -->
    <div style="text-align: center; margin-top: 15px;">
      <a href="map.html" style="padding: 8px 16px; background-color: #409EFF; color: white; text-decoration: none; border-radius: 4px;">查看详细</a>
    </div>
  </div>
</section>

<script>
  // 城市列表
  const cities = [
    { name: "北京", lon: 116.40, lat: 39.90 },
    { name: "上海", lon: 121.47, lat: 31.23 },
    { name: "广州", lon: 113.27, lat: 23.13 },
    { name: "深圳", lon: 114.05, lat: 22.55 },
    { name: "成都", lon: 104.06, lat: 30.67 }
  ];

  // 模拟城市天气数据（可替换为后端接口返回）
  async function fetchCityWeatherData() {
    return cities.map(c => ({
      name: c.name,
      lon: c.lon,
      lat: c.lat,
      temp: (15 + Math.random() * 15).toFixed(1),
      wind: (Math.random() * 10).toFixed(1),
      humidity: (40 + Math.random() * 40).toFixed(0)
    }));
  }

  // 渲染城市散点到地图
  function renderCityWeatherOnMap(cityWeatherData) {
    if (!windyChart) return;

    const scatterSeries = {
      name: "城市实时天气",
      type: "scatter",
      coordinateSystem: "geo",
      symbol: "circle",
      symbolSize: 12,
      itemStyle: { color: "#ffcc00", borderColor: "#fff", borderWidth: 1 },
      data: cityWeatherData.map(c => ({
        name: c.name,
        value: [c.lon, c.lat, c.temp, c.wind, c.humidity]
      })),
      tooltip: {
        formatter: function (p) {
          const v = p.value;
          return `${p.name}<br>
                  温度: ${v[2]}°C<br>
                  风速: ${v[3]} km/h<br>
                  湿度: ${v[4]}%`;
        }
      }
    };

    windyChart.setOption({
      series: (windyChart.getOption().series || []).concat([scatterSeries])
    });

    // 默认显示第一个城市信息
    if (cityWeatherData.length > 0) {
      updateCityInfoPanel(cityWeatherData[0]);
    }
  }

  // 更新右侧城市面板
  function updateCityInfoPanel(city) {
    document.getElementById("city-name").textContent = city.name;
    document.getElementById("lon-value").textContent = city.lon.toFixed(2) + "°E";
    document.getElementById("lat-value").textContent = city.lat.toFixed(2) + "°N";
    document.getElementById("temp-value").textContent = city.temp + "°C";
    document.getElementById("wind-value").textContent = city.wind + " km/h";
    document.getElementById("wind-dir").textContent = "—"; // 需要的话可根据 u,v 算
    document.getElementById("humidity-value").textContent = city.humidity + "%";
  }

  // 页面加载时拉取城市天气
  window.addEventListener("DOMContentLoaded", async () => {
    const cityData = await fetchCityWeatherData();
    renderCityWeatherOnMap(cityData);
  });
</script>


		<section class="data-section" id="data-section">
			<div class="container">
				<div class="section-title">
					<h2>气象数据分析</h2>
					<p>基于历史与实时数据的深度可视化分析</p>
				</div>

				<div class="data-grid">
					<!-- 修改后的平均气温图表 -->
					<div class="data-card">
						<div class="chart-title-with-link">
							<h3>主要城市年平均气温</h3>
							<a href="wind-rose.html?chart=temperature" class="view-all-link" id="temperature-link">
								查看全部 <i class="fas fa-external-link-alt"></i>
							</a>
						</div>
						<div id="temp-chart" class="data-chart clickable-chart"></div>
					</div>

					<div class="data-card">
						<div class="chart-title-with-link">
							<h3>全国各地天气情况分布</h3>
							<a href="wind-rose.html?chart=weather" class="view-all-link" id="weather-link">
								查看全部 <i class="fas fa-external-link-alt"></i>
							</a>
						</div>
						<div id="weather-chart" class="data-chart clickable-chart"></div>
					</div>

					<div class="data-card">
						<div class="chart-title-with-link">
							<h3>风速与风向玫瑰图</h3>
							<a href="wind-rose.html?chart=wind" class="view-all-link" id="wind-rose-link">
								查看全部 <i class="fas fa-external-link-alt"></i>
							</a>
						</div>
						<div id="wind-chart" class="data-chart"></div>
						<div class="wind-rose-title" id="wind-rose-city">北京市风向数据</div>
					</div>
				</div>
			</div>
		</section>

		<section class="lib-info">
			<div class="container">
				<h2>本地依赖文件说明</h2>

				<div class="dependencies-info">
					<h3>已使用的本地依赖文件</h3>
					<div class="dependency-list">
						<div class="dependency-item">
							<h4>ECharts 核心库 (echarts.min.js)</h4>
							<p>用于创建交互式图表和地图的基础库。</p>
							<span class="local-file-status">✅ 已使用本地文件: libs/echarts.min.js</span>
						</div>
						<div class="dependency-item">
							<h4>ECharts GL扩展 (echarts-gl.min.js)</h4>
							<p>提供WebGL渲染能力，用于高性能的风场可视化。</p>
							<span class="local-file-status">✅ 已使用本地文件: libs/echarts-gl.min.js</span>
						</div>
						<div class="dependency-item">
							<h4>中国地图数据 (china.json)</h4>
							<p>包含中国地理信息数据，用于地图渲染。</p>
							<span class="local-file-status">✅ 已使用本地文件: libs/china.json</span>
						</div>
					</div>
				</div>
			</div>
		</section>

		<footer>
			<div class="container">
				<div class="social-icons">
				<p>数据来源: 中国天气网公开数据</p>
				<p>© 气象数据可视化平台 | 基于ECharts GL技术构建</p>
			</div>
		</footer>

		<div class="status-bar">
			<span class="status-indicator"></span>
			<span id="status-text">系统状态: 加载地图数据中...</span>
		</div>

		<!-- 引用本地ECharts库 -->
		<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/echarts-gl@2.0.9/dist/echarts-gl.min.js"></script>

		<script>
			// 全局变量
			let windyChart;
			let currentMode = 'wind';
			let chinaGeoJson = null;
			let weatherData = {}; // 存储加载的天气数据
			let historicalData = {}; // 存储历史数据

			// 省会城市列表及其坐标
			const capitalCities = {
				'beijing': {
					name: '北京',
					coordinates: [116.41, 39.90]
				},
				'shanghai': {
					name: '上海',
					coordinates: [121.48, 31.22]
				},
				'tianjin': {
					name: '天津',
					coordinates: [117.20, 39.13]
				},
				'chongqing': {
					name: '重庆',
					coordinates: [106.54, 29.59]
				},
				'haerbin': {
					name: '哈尔滨',
					coordinates: [126.63, 45.75]
				},
				'changchun': {
					name: '长春',
					coordinates: [125.32, 43.90]
				},
				'shenyang': {
					name: '沈阳',
					coordinates: [123.43, 41.80]
				},
				'huhehaote': {
					name: '呼和浩特',
					coordinates: [111.65, 40.82]
				},
				'shijiazhuang': {
					name: '石家庄',
					coordinates: [114.48, 38.03]
				},
				'xining': {
					name: '西宁',
					coordinates: [101.74, 36.56]
				},
				'lanzhou': {
					name: '兰州',
					coordinates: [103.73, 36.03]
				},
				'yinchuan': {
					name: '银川',
					coordinates: [106.27, 38.47]
				},
				'xian': {
					name: '西安',
					coordinates: [108.93, 34.27]
				},
				'zhengzhou': {
					name: '郑州',
					coordinates: [113.62, 34.72]
				},
				'jinan': {
					name: '济南',
					coordinates: [117.00, 36.65]
				},
				'taiyuan': {
					name: '太原',
					coordinates: [112.53, 37.87]
				},
				'hefei': {
					name: '合肥',
					coordinates: [117.27, 31.86]
				},
				'wuhan': {
					name: '武汉',
					coordinates: [114.31, 30.52]
				},
				'changsha': {
					name: '长沙',
					coordinates: [113.00, 28.21]
				},
				'nanjing': {
					name: '南京',
					coordinates: [118.78, 32.04]
				},
				'chengdu': {
					name: '成都',
					coordinates: [104.06, 30.67]
				},
				'guiyang': {
					name: '贵阳',
					coordinates: [106.71, 26.57]
				},
				'kunming': {
					name: '昆明',
					coordinates: [102.73, 25.04]
				},
				'nanning': {
					name: '南宁',
					coordinates: [108.37, 22.82]
				},
				'lasa': {
					name: '拉萨',
					coordinates: [91.11, 29.61]
				},
				'hangzhou': {
					name: '杭州',
					coordinates: [120.19, 30.26]
				},
				'fuzhou': {
					name: '福州',
					coordinates: [119.30, 26.08]
				},
				'guangzhou': {
					name: '广州',
					coordinates: [113.23, 23.16]
				},
				'haikou': {
					name: '海口',
					coordinates: [110.35, 20.02]
				}
			};

			// 天气图标映射
			const weatherIcons = {
				'晴': '☀️',
				'多云': '⛅',
				'阴': '🌥️',
				'小雨': '🌧️',
				'中雨': '🌧️',
				'大雨': '🌧️',
				'暴雨': '🌧️',
				'雷阵雨': '⛈️',
				'雪': '❄️',
				'雾': '🌫️',
				'霾': '🌫️'
			};

			// 空气质量等级映射
			const aqiLevelsText = {
				'优': {
					color: '#00e400',
					text: '空气质量: 优'
				},
				'良': {
					color: '#ffff00',
					text: '空气质量: 良'
				},
				'轻度污染': {
					color: '#ff7e00',
					text: '空气质量: 轻度污染'
				},
				'中度污染': {
					color: '#ff0000',
					text: '空气质量: 中度污染'
				},
				'重度污染': {
					color: '#99004c',
					text: '空气质量: 重度污染'
				},
				'严重污染': {
					color: '#7e0023',
					text: '空气质量: 严重污染'
				}
			};

			// API基础URL - 请根据您的实际API服务器地址修改
			const API_BASE = 'http://localhost:5000/api';

			// 全局变量
			let currentCityPage = 0;
			const citiesPerPage = 4;

			const eightDirections = {
				'北风': 'N',
				'东北风': 'NE',
				'东风': 'E',
				'东南风': 'SE',
				'南风': 'S',
				'西南风': 'SW',
				'西风': 'W',
				'西北风': 'NW'
			};

			// DOM加载完成后初始化
			document.addEventListener('DOMContentLoaded', function() {
				// 初始化城市卡片
				initCityCards();

				// 启动数据轮询
				setTimeout(startDataPolling, 1000);

				// 添加滚动事件监听
				initScrollHandler();

				// 添加导航按钮功能
				initNavigation();

				// 添加搜索功能
				initSearchFunctionality();

				// 加载资源
				loadResources();
			});

			// 初始化搜索功能
			function initSearchFunctionality() {
				const searchButton = document.getElementById('search-button');
				const searchInput = document.getElementById('city-search-input');
				const searchResults = document.getElementById('search-results');
				const resetButton = document.getElementById('reset-button');
				const searchSuggestions = document.getElementById('search-suggestions');

				if (!searchButton || !searchInput || !searchResults || !resetButton) return;

				// 创建城市名称映射（包含所有城市）
				const cityNameMap = {};
				Object.entries(capitalCities).forEach(([pinyin, cityInfo]) => {
					cityNameMap[cityInfo.name] = pinyin;
					// 添加拼音映射以便支持拼音搜索
					cityNameMap[pinyin] = pinyin;
				});

				// 添加常见城市别名
				const cityAliases = {
					'北京市': 'beijing',
					'上海市': 'shanghai',
					'广州市': 'guangzhou',
					'深圳市': 'shenzhen',
					'成都市': 'chengdu',
					'杭州市': 'hangzhou',
					'武汉市': 'wuhan',
					'西安市': 'xian',
					'南京市': 'nanjing',
					'天津市': 'tianjin',
					'重庆市': 'chongqing',
					'沈阳市': 'shenyang',
					'青岛市': 'qingdao',
					'苏州市': 'suzhou',
					'长沙市': 'changsha',
					'大连市': 'dalian',
					'厦门市': 'xiamen',
					'无锡市': 'wuxi',
					'哈尔滨市': 'haerbin',
					'济南市': 'jinan',
					'宁波市': 'ningbo'
				};

				// 合并别名到城市映射
				Object.assign(cityNameMap, cityAliases);

				// 搜索按钮点击事件
				searchButton.addEventListener('click', function() {
					performSearch();
				});

				// 复位按钮点击事件
				resetButton.addEventListener('click', function() {
					resetSearch();
				});

				// 回车键触发搜索
				searchInput.addEventListener('keypress', function(e) {
					if (e.key === 'Enter') {
						performSearch();
					}
				});

				// 输入时显示搜索建议
				searchInput.addEventListener('input', function() {
					showSearchSuggestions();
				});

				// 点击其他地方隐藏搜索建议
				document.addEventListener('click', function(e) {
					if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
						searchSuggestions.style.display = 'none';
					}
				});

				// 执行搜索的函数
				function performSearch() {
					const searchTerm = searchInput.value.trim().toLowerCase();
					if (!searchTerm) {
						searchResults.innerHTML = '<div class="no-results">请输入城市名称</div>';
						return;
					}

					// 查找匹配的城市
					let foundCity = null;
					for (const [name, pinyin] of Object.entries(cityNameMap)) {
						if (name.toLowerCase().includes(searchTerm) || searchTerm.includes(name.toLowerCase())) {
							foundCity = pinyin;
							break;
						}
					}

					if (foundCity) {
						// 隐藏所有城市卡片
						document.querySelectorAll('.city-card').forEach(card => {
							card.style.display = 'none';
						});

						// 显示匹配的城市卡片
						const targetCard = document.querySelector(`.city-card[data-city="${foundCity}"]`);
						if (targetCard) {
							targetCard.style.display = 'block';

							// 添加高亮效果
							targetCard.classList.add('highlight-card');
							setTimeout(() => {
								targetCard.classList.remove('highlight-card');
							}, 2000);

							// 滚动到该卡片位置
							targetCard.scrollIntoView({
								behavior: 'smooth',
								block: 'center'
							});

							searchResults.innerHTML =
								`<div style="color: #5bc0de;">已找到城市: ${capitalCities[foundCity].name}</div>`;

							// 显示复位按钮
							resetButton.style.display = 'block';
						}
					} else {
						searchResults.innerHTML =
							'<div class="no-results">未找到匹配的城市，请尝试其他名称</div>';

						// 显示所有城市卡片
						document.querySelectorAll('.city-card').forEach(card => {
							card.style.display = 'block';
						});

						// 隐藏复位按钮
						resetButton.style.display = 'none';
					}

					// 隐藏搜索建议
					searchSuggestions.style.display = 'none';
				}

				// 复位搜索的函数
				function resetSearch() {
					// 显示所有城市卡片
					document.querySelectorAll('.city-card').forEach(card => {
						card.style.display = 'block';
					});

					// 清空搜索输入和结果
					searchInput.value = '';
					searchResults.innerHTML = '';

					// 隐藏复位按钮
					resetButton.style.display = 'none';

					// 隐藏搜索建议
					searchSuggestions.style.display = 'none';
				}

				// 显示搜索建议的函数
				function showSearchSuggestions() {
					const searchTerm = searchInput.value.trim().toLowerCase();
					if (!searchTerm) {
						searchSuggestions.style.display = 'none';
						return;
					}

					// 获取匹配的城市
					const matchedCities = [];
					for (const [name, pinyin] of Object.entries(cityNameMap)) {
						if (name.toLowerCase().includes(searchTerm)) {
							matchedCities.push({
								name: name,
								pinyin: pinyin
							});

							// 最多显示8个建议
							if (matchedCities.length >= 8) break;
						}
					}

					// 显示搜索建议
					if (matchedCities.length > 0) {
						searchSuggestions.innerHTML = '';
						matchedCities.forEach(city => {
							const item = document.createElement('div');
							item.className = 'search-suggestion-item';
							item.textContent = city.name;
							item.addEventListener('click', function() {
								searchInput.value = city.name;
								searchSuggestions.style.display = 'none';
								performSearch();
							});
							searchSuggestions.appendChild(item);
						});
						searchSuggestions.style.display = 'block';
					} else {
						searchSuggestions.style.display = 'none';
					}
				}
			}

			// 初始化导航按钮
			function initNavigation() {
				const container = document.querySelector('.city-weather-container');
				const prevButton = document.getElementById('prev-button');
				const nextButton = document.getElementById('next-button');

				if (!container || !prevButton || !nextButton) return;

				// 导航按钮点击事件
				prevButton.addEventListener('click', () => {
					container.scrollBy({
						left: -300,
						behavior: 'smooth'
					});
				});

				nextButton.addEventListener('click', () => {
					container.scrollBy({
						left: 300,
						behavior: 'smooth'
					});
				});

				// 根据滚动位置更新按钮状态
				container.addEventListener('scroll', () => {
					const scrollWidth = container.scrollWidth - container.clientWidth;
					const scrollLeft = container.scrollLeft;

					// 显示/隐藏导航按钮
					prevButton.style.display = scrollLeft > 10 ? 'flex' : 'none';
					nextButton.style.display = scrollLeft < scrollWidth - 10 ? 'flex' : 'none';
				});

				// 初始隐藏左箭头
				prevButton.style.display = 'none';
			}

			// 初始化城市卡片
			function initCityCards() {
				const container = document.getElementById('city-cards-container');
				if (!container) return;

				// 清空容器
				container.innerHTML = '';

				// 创建所有城市卡片
				Object.entries(capitalCities).forEach(([key, city]) => {
					const card = createCityCard(city);
					card.dataset.city = key;
					container.appendChild(card);
				});
			}

			// 创建城市卡片
			function createCityCard(cityInfo) {
				const card = document.createElement('div');
				card.className = 'city-card';

				card.innerHTML = `
			        <div class="city-header">
			            <h3>${cityInfo.name}</h3>
			            <p>实时监测</p>
			        </div>
			        <div class="city-content">
			            <div class="weather-icon">⏳</div>
			            <div class="temp">--°C</div>
			            <p><span class="info-label">天气:</span> <span class="info-value weather-desc">加载中...</span></p>
			            <p><span class="info-label">湿度:</span> <span class="info-value humidity">--%</span></p>
			            <p><span class="info-label">风向风力:</span> <span class="info-value wind">--</span></p>
			            <div class="air-quality">
			                <div class="aqi-value">AQI: --</div>
			                <div class="pm-value">PM2.5: --</div>
			            </div>
			        </div>
			    `;
				return card;
			}

			// 更新城市天气数据
			function updateCityWeather(cityKey, data) {
				const cityCard = document.querySelector(`.city-card[data-city="${cityKey}"]`);
				if (!cityCard || !data) return;

				// 更新温度
				const tempElement = cityCard.querySelector('.temp');
				if (tempElement && data.current_temp) {
					tempElement.textContent = `${data.current_temp}°C`;
				}

				// 更新天气图标和描述
				const weatherIcon = cityCard.querySelector('.weather-icon');
				const weatherDesc = cityCard.querySelector('.weather-desc');
				if (weatherIcon && weatherDesc && data.weather) {
					weatherIcon.textContent = getWeatherIcon(data.weather);
					weatherDesc.textContent = data.weather;
				}

				// 更新湿度
				const humidityElement = cityCard.querySelector('.humidity');
				if (humidityElement && data.humidity) {
					humidityElement.textContent = data.humidity;
				}

				// 更新风向风力
				const windElement = cityCard.querySelector('.wind');
				if (windElement && data.wind_direction) {
					windElement.textContent = data.wind_direction;
				}

				// 更新空气质量 - 修改这部分
				const aqiElement = cityCard.querySelector('.aqi-value');
				const pmElement = cityCard.querySelector('.pm-value');

				if (aqiElement) {
					// 优先使用air_quality字段（文字描述）
					if (data.air_quality) {
						const aqiText = data.air_quality;
						const aqiInfo = aqiLevelsText[aqiText] || {
							text: `AQI: ${data.aqi || '--'}`,
							color: '#ffffff'
						};
						aqiElement.textContent = aqiInfo.text;
						aqiElement.style.color = aqiInfo.color;
					}
					// 如果没有air_quality字段，但有aqi字段，则使用aqi数值
					else if (data.aqi) {
						aqiElement.textContent = `AQI: ${data.aqi}`;
						aqiElement.style.color = getAqiColor(data.aqi);
					}
					// 如果都没有，显示默认值
					else {
						aqiElement.textContent = 'AQI: --';
					}
				}

				if (pmElement && data.pm25) {
					pmElement.textContent = `PM2.5: ${data.pm25}`;
				}
			}

			// 根据天气状况返回对应的图标
			function getWeatherIcon(weather) {
				return weatherIcons[weather] || '🌤️';
			}

			// 根据AQI值返回对应的颜色
			function getAqiColor(aqi) {
				if (aqi <= 50) return '#00e400'; // 优
				if (aqi <= 100) return '#ffff00'; // 良
				if (aqi <= 150) return '#ff7e00'; // 轻度污染
				if (aqi <= 200) return '#ff0000'; // 中度污染
				if (aqi <= 300) return '#99004c'; // 重度污染
				return '#7e0023'; // 严重污染
			}

			// 定期更新数据
			async function startDataPolling() {
				// 更新所有城市数据
				for (const [cityPinyin, cityInfo] of Object.entries(capitalCities)) {
					try {
						const weatherData = await fetchWeatherData(cityPinyin);
						if (weatherData) {
							updateCityWeather(cityPinyin, weatherData);
						} else {
							// 如果API不可用，使用模拟数据
							const simulatedData = generateSimulatedData(cityInfo.name);
							updateCityWeather(cityPinyin, simulatedData);
						}
					} catch (error) {
						console.error(`更新${cityInfo.name}天气数据失败:`, error);
						// 使用模拟数据作为后备
						const simulatedData = generateSimulatedData(cityInfo.name);
						updateCityWeather(cityPinyin, simulatedData);
					}

					// 添加小延迟，避免同时发起大量请求
					await new Promise(resolve => setTimeout(resolve, 100));
				}

				// 设置定时器，每5分钟更新一次
				setTimeout(startDataPolling, 5 * 60 * 1000);
			}

			// 生成模拟数据（当API不可用时使用）
			function generateSimulatedData(cityName) {
				const baseTemps = {
					'北京': 28,
					'上海': 30,
					'广州': 32,
					'成都': 26,
					'哈尔滨': 22,
					'海口': 34,
					'昆明': 24,
					'乌鲁木齐': 20
				};

				const weatherTypes = ['晴', '多云', '阴', '小雨', '中雨', '大雨', '雷阵雨', '雪'];
				const windDirections = ['北风', '东北风', '东风', '东南风', '南风', '西南风', '西风', '西北风'];
				const aqiLevels = ['优', '良', '轻度污染', '中度污染'];

				return {
					current_temp: baseTemps[cityName] || 25 + Math.floor(Math.random() * 10),
					weather: weatherTypes[Math.floor(Math.random() * weatherTypes.length)],
					humidity: Math.floor(40 + Math.random() * 40) + '%',
					wind_direction: windDirections[Math.floor(Math.random() * windDirections.length)],
					wind_level: (1 + Math.floor(Math.random() * 5)) + '级',
					aqi: Math.floor(20 + Math.random() * 100),
					pm25: Math.floor(10 + Math.random() * 20)
				};
			}

			// 初始化滚动处理
			function initScrollHandler() {
				const container = document.querySelector('.city-weather-container');
				const progress = document.getElementById('scroll-progress');

				if (!container || !progress) return;

				container.addEventListener('scroll', function() {
					const scrollWidth = container.scrollWidth - container.clientWidth;
					const scrollLeft = container.scrollLeft;
					const progressPercent = (scrollLeft / scrollWidth) * 100;

					progress.style.width = progressPercent + '%';
				}, {
					passive: true
				});
			}

			// 状态更新函数
			function updateStatus(message) {
				const statusElement = document.getElementById('status-text');
				if (statusElement) {
					statusElement.textContent = `系统状态: ${message}`;
				}
			}

			// 安全获取元素函数
			function getElementSafe(id) {
				const element = document.getElementById(id);
				if (!element) {
					console.warn(`元素 ${id} 不存在`);
				}
				return element;
			}

			// 从API获取天气数据
			async function fetchWeatherData(city) {
				try {
					const response = await fetch(`${API_BASE}/weather/${city}`);
					if (!response.ok) throw new Error('网络响应不正常');
					return await response.json();
				} catch (error) {
					console.error(`获取${city}天气数据失败:`, error);
					return null;
				}
			}

			// 获取风场数据
			async function fetchWindData() {
				try {
					const response = await fetch(`${API_BASE}/wind-data`);
					if (!response.ok) throw new Error('网络响应不正常');
					const data = await response.json();

					// 确保数据格式正确
					if (data && data.points && Array.isArray(data.points)) {
						return data;
					} else {
						throw new Error('风场数据格式不正确');
					}
				} catch (error) {
					console.error('获取风场数据失败:', error);
					return null;
				}
			}

			// 更新风场可视化
			function updateWindVisualization(windData) {
				if (!windyChart) return;

				// 处理数据
				const processedData = processWindyData(windData);

				// 更新图表选项
				const option = windyChart.getOption();
				option.series[0].data = processedData;

				// 重新设置选项
				windyChart.setOption(option);

				// 更新状态显示
				updateStatus('风场数据已更新');
			}

			// 处理风场数据格式
			function processWindyData(windData) {
				const processedData = [];

				// 处理API返回的实际数据
				if (windData && windData.points) {
					windData.points.forEach(point => {
						processedData.push([
							point.lon,
							point.lat,
							point.u,
							point.v,
							point.speed,
							point.temp
						]);
					});
				}

				return processedData;
			}

			// 更新数据状态显示
			function updateDataStatus(message, isError = false) {
				const statusElement = document.getElementById('data-status');
				if (statusElement) {
					statusElement.innerHTML = isError ?
						`<p style="color: #ff6b6b;">${message}</p><button class="retry-button" id="retry-button">重试加载数据</button>` :
						`<p>${message}</p>`;

					if (isError) {
						const retryButton = document.getElementById('retry-button');
						retryButton.addEventListener('click', startDataPolling);
					}
				}
			}

			// 加载资源
			async function loadResources() {
				updateStatus('正在加载地图数据...');

				try {
					// 加载中国地图GeoJSON
					const chinaResponse = await fetch('https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json');
					if (!chinaResponse.ok) throw new Error('地图数据加载失败');
					chinaGeoJson = await chinaResponse.json();

					// 确保地图数据有效
					if (!chinaGeoJson || !chinaGeoJson.features || chinaGeoJson.features.length === 0) {
						throw new Error('地图数据格式无效');
					}

					// 注册地图
					echarts.registerMap('china', chinaGeoJson);

					updateStatus('正在加载天气数据...');

					// 加载天气数据
					await loadWeatherData();

					// 加载风场数据
					const windData = await fetchWindData();
					if (windData) {
						updateWindVisualization(windData);
						updateStatus('风场数据加载完成');
					} else {
						throw new Error('风场数据加载失败');
					}

					updateStatus('资源加载完成');

					// 在处理完天气数据后，保存到localStorage
					localStorage.setItem('allWeatherData', JSON.stringify(weatherData));

					// 初始化图表
					initWindyChart();

					// 初始化城市图表
					initCityCharts();

					// 初始化数据分析图表
					initDataCharts();

					// 隐藏加载层
					const loadingOverlay = document.getElementById('loading-overlay');
					if (loadingOverlay) {
						loadingOverlay.style.opacity = '0';
						setTimeout(() => {
							loadingOverlay.style.display = 'none';
						}, 500);
					}

				} catch (error) {
					console.error('资源加载失败:', error);
					updateStatus(`加载失败: ${error.message}`);

					// 使用模拟数据作为后备
					setTimeout(() => {
						initWindyChart();
					}, 2000);
				}
			}

			// 加载天气数据
			async function loadWeatherData() {
				const dataLoadPromises = [];

				for (const [cityPinyin, cityInfo] of Object.entries(capitalCities)) {
					dataLoadPromises.push(
						fetchWeatherData(cityPinyin)
						.then(data => {
							if (data) {
								weatherData[cityPinyin] = {
									name: cityInfo.name,
									coordinates: cityInfo.coordinates,
									data: data
								};
							} else {
								// 使用模拟数据作为后备
								console.warn(`使用模拟数据作为${cityInfo.name}的后备`);
								weatherData[cityPinyin] = {
									name: cityInfo.name,
									coordinates: cityInfo.coordinates,
									data: generateSimulatedData(cityInfo.name)
								};
							}
						})
						.catch(error => {
							console.error(`加载 ${cityInfo.name} 数据失败:`, error);
							// 使用模拟数据作为后备
							weatherData[cityPinyin] = {
								name: cityInfo.name,
								coordinates: cityInfo.coordinates,
								data: generateSimulatedData(cityInfo.name)
							};
						})
					);
				}

				await Promise.allSettled(dataLoadPromises);
				console.log('天气数据加载完成', weatherData);
			}

			// 加载历史数据函数
			async function loadHistoricalData() {
				updateStatus('正在加载历史数据...');

				const dataLoadPromises = [];

				for (const [cityPinyin, cityInfo] of Object.entries(capitalCities)) {
					const promise = fetch(`data/${cityPinyin}.json`)
						.then(response => {
							if (!response.ok) {
								throw new Error(`网络响应不正常: ${response.status}`);
							}
							return response.json();
						})
						.then(data => {
							historicalData[cityPinyin] = {
								name: cityInfo.name,
								coordinates: cityInfo.coordinates,
								data: data
							};
							console.log(`${cityInfo.name}历史数据加载成功`, data);
						})
						.catch(error => {
							console.error(`加载 ${cityInfo.name} 历史数据失败:`, error);
							// 使用模拟历史数据作为后备
							historicalData[cityPinyin] = {
								name: cityInfo.name,
								coordinates: cityInfo.coordinates,
								data: generateSimulatedHistoricalData(cityInfo.name)
							};
						});

					dataLoadPromises.push(promise);
				}

				await Promise.allSettled(dataLoadPromises);
				console.log('历史数据加载完成', historicalData);

				// 初始化数据分析图表
				initDataCharts();
			}

			// 定期更新风场数据
			async function updateWindDataPeriodically() {
				try {
					const windData = await fetchWindData();
					if (windData) {
						updateWindVisualization(windData);
					}
				} catch (error) {
					console.error('更新风场数据失败:', error);
				}

				// 每10分钟更新一次
				setTimeout(updateWindDataPeriodically, 10 * 60 * 1000);
			}

			// 生成模拟历史数据
			function generateSimulatedHistoricalData(cityName) {
				const data = [];
				const startDate = new Date(2020, 0, 1);

				for (let i = 0; i < 365 * 3; i++) { // 3年的数据
					const currentDate = new Date(startDate);
					currentDate.setDate(startDate.getDate() + i);

					const dateStr = currentDate.toISOString().split('T')[0];
					const weekDays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
					const weekDay = weekDays[currentDate.getDay()];

					// 根据城市和季节生成不同的温度
					let baseTemp = 15;
					if (cityName.includes('北京') || cityName.includes('哈尔滨')) {
						baseTemp = 10;
					} else if (cityName.includes('广州') || cityName.includes('海口')) {
						baseTemp = 25;
					}

					// 季节影响
					const month = currentDate.getMonth();
					let seasonalEffect = 0;
					if (month >= 2 && month <= 4) { // 春季
						seasonalEffect = 5;
					} else if (month >= 5 && month <= 7) { // 夏季
						seasonalEffect = 15;
					} else if (month >= 8 && month <= 10) { // 秋季
						seasonalEffect = 5;
					} else { // 冬季
						seasonalEffect = -5;
					}

					const highTemp = Math.round(baseTemp + seasonalEffect + (Math.random() * 10 - 5));
					const lowTemp = Math.round(highTemp - 5 - Math.random() * 5);

					const weatherTypes = ['晴', '多云', '阴', '小雨', '中雨', '大雨', '雪'];
					const weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];

					const windDirections = ['北风', '东北风', '东风', '东南风', '南风', '西南风', '西风', '西北风'];
					const windDirection = windDirections[Math.floor(Math.random() * windDirections.length)];
					const windLevel = Math.floor(Math.random() * 5) + 1;

					data.push({
						"日期": `${dateStr} ${weekDay}`,
						"最高温": `${highTemp}℃`,
						"最低温": `${lowTemp}℃`,
						"天气": weather,
						"风向风力": `${windDirection} ${windLevel}级`
					});
				}

				return data;
			}

			// 处理温度数据，从字符串中提取数字
			function parseTemperature(tempStr) {
				if (!tempStr) return null;
				const match = tempStr.match(/(-?\d+)℃/);
				return match ? parseInt(match[1]) : null;
			}

			// 计算城市年平均气温
			function calculateYearlyAverageTemperatures(cityData) {
				const yearlyTemps = {};

				cityData.data.forEach(day => {
					const datePart = day.日期.split(' ')[0]; // 获取日期部分
					const date = new Date(datePart);
					// 检查日期是否有效
					if (isNaN(date.getTime())) {
						console.warn('无效日期:', day.日期);
						return;
					}

					const year = date.getFullYear();

					if (!yearlyTemps[year]) {
						yearlyTemps[year] = {
							sum: 0,
							count: 0
						};
					}

					const highTemp = parseTemperature(day.最高温);
					const lowTemp = parseTemperature(day.最低温);

					if (highTemp !== null && lowTemp !== null) {
						const avgTemp = (highTemp + lowTemp) / 2;
						yearlyTemps[year].sum += avgTemp;
						yearlyTemps[year].count++;
					}
				});

				const result = {};
				for (const [year, data] of Object.entries(yearlyTemps)) {
					if (data.count > 0) {
						result[year] = data.sum / data.count;
					}
				}

				return result;
			}

			// 计算天气情况分布
			function calculateWeatherDistribution(cityData) {
				const weatherCount = {};
				let totalDays = 0;

				cityData.data.forEach(day => {
					if (day.天气) {
						// 处理复合天气情况，如"晴转多云"
						const weathers = day.天气.split(/转|到|,/);
						weathers.forEach(weather => {
							const trimmedWeather = weather.trim();
							if (trimmedWeather) {
								weatherCount[trimmedWeather] = (weatherCount[trimmedWeather] || 0) + 1;
								totalDays++;
							}
						});
					}
				});

				// 转换为百分比
				const result = {};
				for (const [weather, count] of Object.entries(weatherCount)) {
					result[weather] = (count / totalDays) * 100;
				}

				return result;
			}

			// 初始化数据分析图表
			function initDataCharts() {
				// 清除加载状态提示
				document.querySelectorAll('.data-loading').forEach(el => {
					el.remove();
				});

				// 年平均气温柱状图
				initTempChart();

				// 天气情况分布图
				initWeatherChart();

				// 风速风向图
				initWindChart();

				updateStatus('数据分析图表初始化完成');
			}

			function initTempChart() {
				const chartDom = getElementSafe('temp-chart');
				if (!chartDom) {
					console.warn('无法找到temp-chart元素');
					return;
				}

				const chart = echarts.init(chartDom);

				// 选择要显示的少数城市
				const selectedCities = ['北京', '上海', '广州', '成都'];
				const cityData = [];
				const temperatures = [];

				// 从历史数据中提取选定城市的温度数据
				selectedCities.forEach(cityName => {
					// 查找对应的城市数据
					for (const [cityPinyin, cityInfo] of Object.entries(historicalData)) {
						if (cityInfo.name === cityName) {
							const yearlyTemps = calculateYearlyAverageTemperatures(cityInfo);

							// 获取最近一年的温度数据
							const years = Object.keys(yearlyTemps).sort();
							if (years.length > 0) {
								const latestYear = years[years.length - 1];
								cityData.push({
									name: cityName,
									temperature: yearlyTemps[latestYear]
								});
							}
							break;
						}
					}
				});

				// 准备图表数据
				const cityNames = cityData.map(item => item.name);
				const tempValues = cityData.map(item => item.temperature ? item.temperature.toFixed(1) : 0);

				const option = {
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'shadow'
						},
						formatter: function(params) {
							return `${params[0].name}<br/>平均气温: ${params[0].value}°C`;
						}
					},
					grid: {
						left: '3%',
						right: '4%',
						bottom: '3%',
						top: '10%',
						containLabel: true
					},
					xAxis: {
						type: 'category',
						data: cityNames,
						axisLine: {
							lineStyle: {
								color: '#5bc0de'
							}
						},
						axisLabel: {
							color: '#aaccff',
							interval: 0,
							rotate: 0 // 可以根据城市名称长度调整旋转角度
						}
					},
					yAxis: {
						type: 'value',
						name: '温度 °C',
						nameTextStyle: {
							color: '#aaccff'
						},
						axisLine: {
							lineStyle: {
								color: '#5bc0de'
							}
						},
						splitLine: {
							lineStyle: {
								color: 'rgba(91, 192, 222, 0.1)'
							}
						},
						axisLabel: {
							color: '#aaccff',
							formatter: '{value}°C'
						}
					},
					series: [{
						name: '年平均气温',
						type: 'bar',
						data: tempValues,
						itemStyle: {
							color: function(params) {
								// 根据温度值设置颜色
								const temp = params.value;
								if (temp < 0) return '#313695';
								if (temp < 10) return '#4575b4';
								if (temp < 20) return '#74add1';
								if (temp < 25) return '#abd9e9';
								if (temp < 30) return '#ffffbf';
								if (temp < 35) return '#fee090';
								return '#f46d43';
							}
						},
						label: {
							show: true,
							position: 'top',
							color: '#e0f0ff',
							formatter: '{c}°C'
						}
					}]
				};

				chart.setOption(option);

				// 添加点击事件 - 点击图表跳转到详细页面
				chart.on('click', function() {
					// 存储全部城市温度数据到localStorage，以便新页面使用
					const allCityTemps = {};
					for (const [cityPinyin, cityInfo] of Object.entries(historicalData)) {
						const yearlyTemps = calculateYearlyAverageTemperatures(cityInfo);
						const years = Object.keys(yearlyTemps).sort();
						if (years.length > 0) {
							const latestYear = years[years.length - 1];
							allCityTemps[cityInfo.name] = yearlyTemps[latestYear];
						}
					}

					localStorage.setItem('allCityTemperatures', JSON.stringify(allCityTemps));
					window.open('temperature-comparison.html', '_blank');
				});

				// 添加响应式处理
				window.addEventListener('resize', function() {
					chart.resize();
				}, {
					passive: true
				});

				// 为查看全部按钮添加点击事件
				const temperatureLink = document.getElementById('temperature-link');
				if (temperatureLink) {
					temperatureLink.addEventListener('click', function(e) {
						e.preventDefault();

						// 存储全部城市温度数据到localStorage
						const allCityTemps = {};
						for (const [cityPinyin, cityInfo] of Object.entries(historicalData)) {
							const yearlyTemps = calculateYearlyAverageTemperatures(cityInfo);
							const years = Object.keys(yearlyTemps).sort();
							if (years.length > 0) {
								const latestYear = years[years.length - 1];
								allCityTemps[cityInfo.name] = yearlyTemps[latestYear];
							}
						}

						localStorage.setItem('allCityTemperatures', JSON.stringify(allCityTemps));
						// 修改为跳转到wind-rose.html并传递参数
						window.open('wind-rose.html?chart=temperature', '_blank');
					});
				}
			}

			// 提取渲染图表的公共代码
			function renderTemperatureChart(chart, yearData, years) {
				// 计算温度范围用于视觉映射
				const allTemps = [];
				Object.values(yearData).forEach(data => {
					data.forEach(item => {
						if (item.value && item.value.length > 2) {
							allTemps.push(item.value[2]);
						}
					});
				});

				const minTemp = Math.min(...allTemps);
				const maxTemp = Math.max(...allTemps);

				const option = {
					tooltip: {
						trigger: 'item',
						formatter: function(params) {
							if (!params.data || !params.data.value) {
								return '无数据';
							}
							return `${params.data.name}<br/>年平均气温: ${params.data.value[2].toFixed(1)}°C`;
						}
					},
					visualMap: {
						min: minTemp - 2,
						max: maxTemp + 2,
						calculable: true,
						inRange: {
							color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61',
								'#f46d43', '#d73027', '#a50026'
							]
						},
						textStyle: {
							color: '#e0f0ff'
						},
						left: 'left',
						bottom: '10%',
						orient: 'vertical',
						backgroundColor: 'rgba(15, 40, 65, 0.7)',
						borderColor: 'rgba(91, 192, 222, 0.4)'
					},
					geo: {
						map: 'china',
						roam: true,
						zoom: 1.2,
						label: {
							emphasis: {
								show: true,
								color: '#ffffff'
							}
						},
						itemStyle: {
							areaColor: 'rgba(20, 40, 80, 0.6)',
							borderColor: '#3a6990',
							borderWidth: 1.5
						},
						emphasis: {
							itemStyle: {
								areaColor: 'rgba(40, 100, 180, 0.7)'
							}
						}
					},
					series: years.map(year => ({
						name: `${year}年平均气温`,
						type: 'scatter',
						coordinateSystem: 'geo',
						data: yearData[year],
						symbolSize: function(val) {
							if (!val || val.length < 3) return 8;
							return Math.max(8, Math.min(20, (val[2] - 10) * 0.5));
						},
						encode: {
							value: 2
						},
						itemStyle: {
							color: function(params) {
								if (!params.data || !params.data.value || params.data.value.length < 3) {
									return '#4575b4';
								}
								const temp = params.data.value[2];
								if (temp < 0) return '#313695';
								if (temp < 10) return '#4575b4';
								if (temp < 20) return '#74add1';
								if (temp < 25) return '#abd9e9';
								if (temp < 30) return '#ffffbf';
								if (temp < 35) return '#fee090';
								return '#f46d43';
							}
						}
					}))
				};

				chart.setOption(option);

				// 添加响应式处理
				window.addEventListener('resize', function() {
					chart.resize();
				}, {
					passive: true
				});
			}

			// 初始化Windy图表
			function initWindyChart() {
				const chartDom = document.getElementById('windy-map');
				if (!chartDom) {
					console.error('无法找到windy-map元素');
					return;
				}

				windyChart = echarts.init(chartDom);

				// 创建初始选项
				const option = createWindyChartOption();
				windyChart.setOption(option);

				// 响应窗口大小变化
				window.addEventListener('resize', function() {
					windyChart.resize();
				}, {
					passive: true
				});

				updateStatus('风场数据加载完成');

				// 模拟数据更新
				setInterval(() => {
					const windValue = getElementSafe('wind-value');
					if (windValue) {
						const windSpeed = (Math.random() * 15 + 5).toFixed(1);
						windValue.textContent = `${windSpeed} km/h`;
					}
				}, 5000);

				// 启动定期更新
				updateWindDataPeriodically();
			}

			// 创建Windy图表选项
			function createWindyChartOption() {
				const isWindMode = currentMode === 'wind';
				const isTempMode = currentMode === 'temp';
				const isRainMode = currentMode === 'rain';

				// 生成模拟数据
				const windData = generateWindData();
				const tempData = generateTempData();
				const rainData = generateRainData();

				// 确保地图数据存在
				let mapOption = {};
				if (chinaGeoJson && chinaGeoJson.features && chinaGeoJson.features.length > 0) {
					mapOption = {
						map: 'china',
						roam: true,
						zoom: 3,
						center: [105, 36],
						label: {
							emphasis: {
								show: true,
								color: '#ffffff'
							}
						},
						itemStyle: {
							areaColor: {
								type: 'linear-gradient',
								x: 0,
								y: 0,
								x2: 0,
								y2: 1,
								colorStops: [{
									offset: 0,
									color: 'rgba(20, 40, 80, 0.6)'
								}, {
									offset: 1,
									color: 'rgba(10, 30, 60, 0.8)'
								}]
							},
							borderColor: '#3a6990',
							borderWidth: 1.5
						},
						emphasis: {
							itemStyle: {
								areaColor: 'rgba(40, 100, 180, 0.7)'
							}
						}
					};
				} else {
					// 使用世界地图作为备选
					mapOption = {
						map: 'world',
						roam: true,
						zoom: 3,
						center: [105, 36],
						itemStyle: {
							areaColor: 'rgba(20, 40, 80, 0.6)',
							borderColor: '#3a6990',
							borderWidth: 1.5
						}
					};
				}

				return {
					backgroundColor: 'transparent',
					tooltip: {
						trigger: 'item',
						backgroundColor: 'rgba(10, 25, 40, 0.9)',
						borderColor: 'rgba(91, 192, 222, 0.5)',
						textStyle: {
							color: '#e0f0ff',
							fontSize: 14
						},
						formatter: function(params) {
							if (params.seriesType === 'custom') {
								const value = params.value;
								return `
                                <div style="margin: 5px 0; font-weight: bold; color: #5bc0de;">位置信息</div>
                                <div>经度: ${value[0].toFixed(2)}°E</div>
                                <div>纬度: ${value[1].toFixed(2)}°N</div>
                                <div style="margin-top: 10px; font-weight: bold; color: #ffcc00;">气象数据</div>
                                <div>风速: <span style="color: #f46d43;">${value[4].toFixed(1)} km/h</span></div>
                                <div>温度: <span style="color: #ff9900;">${value[5].toFixed(1)}°C</span></div>
                            `;
							} else if (params.seriesType === 'scatter') {
								return `降雨强度: ${(params.value[2] * 100).toFixed(0)}%`;
							} else if (params.seriesType === 'heatmap') {
								return `温度: ${params.value[2]}°C`;
							}
						}
					},
					visualMap: [{
						show: true,
						min: isWindMode ? 0 : 10,
						max: isWindMode ? 40 : 38,
						dimension: isWindMode ? 4 : 2,
						calculable: true,
						inRange: {
							color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090',
								'#fdae61', '#f46d43', '#d73027', '#a50026'
							]
						},
						textStyle: {
							color: '#e0f0ff'
						},
						left: 'left',
						bottom: '10%',
						orient: 'vertical',
						backgroundColor: 'rgba(15, 40, 65, 0.7)',
						borderColor: 'rgba(91, 192, 222, 0.4)'
					}],
					geo: mapOption,
					series: [
						// 风场粒子流
						{
							type: 'custom',
							coordinateSystem: 'geo',
							renderItem: renderWindParticle,
							data: windData,
							progressive: 1000,
							blendMode: 'lighter',
							zlevel: 10,
							itemStyle: {
								opacity: isWindMode ? 0.9 : 0.3
							}
						},
						// 温度热力图
						{
							type: 'heatmap',
							coordinateSystem: 'geo',
							data: tempData,
							pointSize: 12,
							blurSize: 18,
							zlevel: 1,
							visualMapIndex: 0,
							itemStyle: {
								opacity: isTempMode ? 0.7 : 0.3
							}
						},
						// 降水数据
						{
							type: 'scatter',
							coordinateSystem: 'geo',
							symbol: 'circle',
							symbolSize: function(val) {
								return Math.min(35, Math.max(6, val[2] * 50));
							},
							data: rainData,
							zlevel: 5,
							itemStyle: {
								color: function(params) {
									const intensity = params.value[2];
									return `rgba(65, 105, 225, ${intensity * 0.8})`;
								},
								opacity: isRainMode ? 0.8 : 0.2
							}
						}
					]
				};
			}

			// 生成风场数据
			function generateWindData() {
				const data = [];
				const gridSize = 50;
				const lonMin = 70;
				const lonMax = 140;
				const latMin = 15;
				const latMax = 55;

				// 模拟一个台风系统
				const typhoonLon = 122;
				const typhoonLat = 28;
				const typhoonRadius = 15;

				for (let i = 0; i < gridSize; i++) {
					for (let j = 0; j < gridSize; j++) {
						const lon = lonMin + (lonMax - lonMin) * i / (gridSize - 1);
						const lat = latMin + (latMax - latMin) * j / (gridSize - 1);

						// 计算到台风中心的距离
						const distanceToTyphoon = Math.sqrt(
							Math.pow(lon - typhoonLon, 2) + Math.pow(lat - typhoonLat, 2)
						);

						let u, v, speed;

						if (distanceToTyphoon < typhoonRadius) {
							// 台风区域 - 强风
							speed = 15 + 30 * (1 - distanceToTyphoon / typhoonRadius);

							// 台风旋转方向 (逆时针)
							const angle = Math.atan2(lat - typhoonLat, lon - typhoonLon);
							u = -Math.sin(angle) * speed;
							v = Math.cos(angle) * speed;
						} else {
							// 正常区域
							speed = 5 + 12 * Math.sin(lon / 12) * Math.cos(lat / 10) + Math.random() * 3;

							// 模拟主要风向 (西风带)
							u = -speed * 0.9;
							v = speed * 0.3 * Math.sin(lon / 15);
						}

						// 添加温度数据
						const temp = 30 - Math.abs(lat - 35) * 0.7 + Math.sin(lon * 0.1) * 3;

						data.push([lon, lat, u, v, speed, temp]);
					}
				}

				return data;
			}

			// 生成温度数据
			function generateTempData() {
				const data = [];
				const gridSize = 60;
				const lonMin = 70;
				const lonMax = 140;
				const latMin = 15;
				const latMax = 55;

				for (let i = 0; i < gridSize; i++) {
					for (let j = 0; j < gridSize; j++) {
						const lon = lonMin + (lonMax - lonMin) * i / (gridSize - 1);
						const lat = latMin + (latMax - latMin) * j / (gridSize - 1);

						// 温度数据 - 南方热北方冷
						const baseTemp = 30 - Math.abs(lat - 35) * 0.7;
						const variation = Math.sin(lon * 0.1) * 3 + Math.cos(lat * 0.15) * 2;
						const temp = baseTemp + variation;
						data.push([lon, lat, temp]);
					}
				}

				return data;
			}

			// 生成降水数据
			function generateRainData() {
				const data = [];

				// 模拟几个降雨区域
				const rainAreas = [{
						lon: 115,
						lat: 30,
						radius: 8,
						intensity: 0.8
					},
					{
						lon: 125,
						lat: 35,
						radius: 5,
						intensity: 0.6
					},
					{
						lon: 105,
						lat: 25,
						radius: 6,
						intensity: 0.7
					},
					{
						lon: 95,
						lat: 40,
						radius: 7,
						intensity: 0.5
					}
				];

				for (const area of rainAreas) {
					for (let i = 0; i < 100; i++) {
						const angle = Math.random() * Math.PI * 2;
						const radius = Math.random() * area.radius;
						const lon = area.lon + Math.cos(angle) * radius;
						const lat = area.lat + Math.sin(angle) * radius;

						// 降雨强度
						const intensity = area.intensity * (1 - radius / area.radius) * (0.8 + Math.random() * 0.4);

						data.push([lon, lat, intensity]);
					}
				}

				return data;
			}

			// 渲染风场粒子
			function renderWindParticle(params, api) {
				const coord = api.coord([api.value(0), api.value(1)]);
				const u = api.value(2);
				const v = api.value(3);
				const speed = api.value(4);

				// 确保坐标有效
				if (!coord || isNaN(coord[0]) || isNaN(coord[1])) {
					return;
				}

				// 确保视口信息存在
				if (!params.viewport || typeof params.viewport.width !== 'number') {
					return;
				}

				// 跳过屏幕外的点
				if (coord[0] < -100 || coord[0] > params.viewport.width + 100 ||
					coord[1] < -100 || coord[1] > params.viewport.height + 100) {
					return;
				}

				// 风速决定粒子长度
				const length = Math.min(50, Math.max(10, speed * 1.5));

				// 计算方向角度
				const angle = Math.atan2(v, u);

				// 风速决定颜色
				const color = speed < 5 ? '#74add1' :
					speed < 10 ? '#abd9e9' :
					speed < 15 ? '#fee090' :
					speed < 25 ? '#fdae61' : '#f46d43';

				// 创建粒子路径
				const path = [
					['M', 0, 0],
					['L', length, 0]
				];

				return {
					type: 'path',
					shape: {
						path: path
					},
					rotation: angle,
					position: coord,
					style: {
						stroke: color,
						lineWidth: Math.min(5, Math.max(1.5, speed * 0.4)),
						opacity: api.style('opacity'),
						shadowBlur: speed > 20 ? 15 : 0,
						shadowColor: speed > 20 ? '#ff3300' : 'transparent'
					},
					z2: 100
				};
			}

			// 城市天气图表初始化
			function initCityCharts() {
				const cities = ['beijing', 'shanghai', 'guangzhou', 'chengdu'];

				cities.forEach(city => {
					const chartDom = getElementSafe(`${city}-chart`);
					if (!chartDom) {
						console.warn(`无法找到 ${city}-chart 元素`);
						return;
					}

					const chart = echarts.init(chartDom);

					// 模拟24小时温度数据
					const hours = [];
					const temps = [];
					for (let i = 0; i < 24; i++) {
						hours.push(`${i}:00`);
						// 根据不同城市生成不同的温度曲线
						let baseTemp;
						switch (city) {
							case 'beijing':
								baseTemp = 25;
								break;
							case 'shanghai':
								baseTemp = 28;
								break;
							case 'guangzhou':
								baseTemp = 30;
								break;
							case 'chengdu':
								baseTemp = 26;
								break;
						}
						temps.push((baseTemp + Math.sin(i * Math.PI / 12) * 5 + Math.random() * 2).toFixed(1));
					}

					const option = {
						grid: {
							left: '3%',
							right: '4%',
							bottom: '3%',
							top: '10%',
							containLabel: true
						},
						tooltip: {
							trigger: 'axis'
						},
						xAxis: {
							type: 'category',
							data: hours,
							axisLine: {
								lineStyle: {
									color: '#5bc0de'
								}
							},
							axisLabel: {
								color: '#aaccff',
								interval: 3
							}
						},
						yAxis: {
							type: 'value',
							name: '温度 °C',
							nameTextStyle: {
								color: '#aaccff'
							},
							axisLine: {
								lineStyle: {
									color: '#5bc0de'
								}
							},
							splitLine: {
								lineStyle: {
									color: 'rgba(91, 192, 222, 0.1)'
								}
							},
							axisLabel: {
								color: '#aaccff'
							}
						},
						series: [{
							name: '温度',
							type: 'line',
							data: temps,
							smooth: true,
							symbol: 'circle',
							symbolSize: 6,
							lineStyle: {
								width: 3,
								color: '#ffcc00'
							},
							itemStyle: {
								color: '#ffcc00'
							},
							areaStyle: {
								color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
										offset: 0,
										color: 'rgba(255, 204, 0, 0.3)'
									},
									{
										offset: 1,
										color: 'rgba(255, 204, 0, 0.05)'
									}
								])
							}
						}]
					};

					chart.setOption(option);

					// 添加响应式处理
					window.addEventListener('resize', function() {
						chart.resize();
					}, {
						passive: true
					});
				});
			}

			// 修改后的initWeatherChart函数
			function initWeatherChart() {
				const chartDom = getElementSafe('weather-chart');
				if (!chartDom) {
					console.warn('无法找到weather-chart元素');
					return;
				}

				const chart = echarts.init(chartDom);

				// 处理数据：计算每个城市的天气情况分布
				const cityWeatherData = {};

				for (const [cityPinyin, cityData] of Object.entries(historicalData)) {
					const weatherDistribution = calculateWeatherDistribution(cityData);
					cityWeatherData[cityData.name] = weatherDistribution;
				}

				// 如果没有数据，使用模拟数据
				if (Object.keys(cityWeatherData).length === 0) {
					for (const [cityPinyin, cityInfo] of Object.entries(capitalCities)) {
						const weatherTypes = ['晴', '多云', '阴', '小雨', '中雨', '大雨', '雪'];
						const distribution = {};

						// 生成随机分布
						let remaining = 100;
						for (let i = 0; i < weatherTypes.length; i++) {
							if (i === weatherTypes.length - 1) {
								distribution[weatherTypes[i]] = remaining;
							} else {
								const value = Math.random() * remaining * 0.7;
								distribution[weatherTypes[i]] = value;
								remaining -= value;
							}
						}

						cityWeatherData[cityInfo.name] = distribution;
					}
				}

				// 获取所有天气类型并按出现频率排序
				const allWeatherTypes = new Set();
				Object.values(cityWeatherData).forEach(distribution => {
					Object.keys(distribution).forEach(weather => {
						allWeatherTypes.add(weather);
					});
				});

				// 计算每种天气类型的总出现频率
				const weatherFrequency = {};
				allWeatherTypes.forEach(weather => {
					weatherFrequency[weather] = 0;
					Object.values(cityWeatherData).forEach(distribution => {
						weatherFrequency[weather] += distribution[weather] || 0;
					});
				});

				// 按频率排序并选择前5种主要天气类型
				const sortedWeatherTypes = Array.from(allWeatherTypes).sort((a, b) => {
					return weatherFrequency[b] - weatherFrequency[a];
				});

				const mainWeatherTypes = sortedWeatherTypes.slice(0, 5);
				mainWeatherTypes.push('其他'); // 添加"其他"类别

				// 重组数据，将非主要天气类型合并到"其他"
				const processedCityData = {};
				Object.entries(cityWeatherData).forEach(([city, distribution]) => {
					processedCityData[city] = {};
					let otherPercentage = 0;

					Object.entries(distribution).forEach(([weather, percentage]) => {
						if (mainWeatherTypes.includes(weather)) {
							processedCityData[city][weather] = percentage;
						} else {
							otherPercentage += percentage;
						}
					});

					if (otherPercentage > 0) {
						processedCityData[city]['其他'] = otherPercentage;
					}

					// 确保所有主要天气类型都有值（即使为0）
					mainWeatherTypes.forEach(weather => {
						if (!processedCityData[city][weather]) {
							processedCityData[city][weather] = 0;
						}
					});
				});

				// 修改：只选择4个主要城市展示
				const selectedCities = ['北京', '上海', '广州', '成都'];
				const seriesData = [];

				mainWeatherTypes.forEach(weather => {
					const data = selectedCities.map(city => {
						return processedCityData[city][weather] || 0;
					});

					seriesData.push({
						name: weather,
						type: 'bar',
						stack: '总量',
						data: data,
						emphasis: {
							focus: 'series'
						}
					});
				});

				const option = {
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'shadow'
						},
						formatter: function(params) {
							let result = params[0].name + '<br/>';
							let total = 0;

							params.forEach(param => {
								result += `${param.seriesName}: ${param.value.toFixed(1)}%<br/>`;
								total += param.value;
							});

							result += `<hr style="margin: 5px 0; border: none; border-top: 1px solid #ccc;"/>`;
							result += `总计: ${total.toFixed(1)}%`;

							return result;
						}
					},
					legend: {
						data: mainWeatherTypes,
						textStyle: {
							color: '#aaccff'
						},
						top: 10,
						right: 10,
						selectedMode: true, // 允许选择图例
						type: 'scroll' // 如果图例过多，添加滚动条
					},
					grid: {
						left: '3%',
						right: '4%',
						bottom: '3%',
						top: '20%',
						containLabel: true
					},
					xAxis: {
						type: 'category',
						data: selectedCities,
						axisLine: {
							lineStyle: {
								color: '#5bc0de'
							}
						},
						axisLabel: {
							color: '#aaccff'
						}
					},
					yAxis: {
						type: 'value',
						name: '出现概率(%)',
						nameTextStyle: {
							color: '#aaccff'
						},
						axisLine: {
							lineStyle: {
								color: '#5bc0de'
							}
						},
						splitLine: {
							lineStyle: {
								color: 'rgba(91, 192, 222, 0.1)'
							}
						},
						axisLabel: {
							color: '#aaccff',
							formatter: '{value}%'
						}
					},
					series: seriesData
				};

				chart.setOption(option);

				// 添加点击事件
				chart.on('click', function() {
					// 存储数据到localStorage，以便新页面使用
					localStorage.setItem('weatherDistributionData', JSON.stringify(cityWeatherData));
					// 打开新页面
					window.open('weather-distribution.html', '_blank');
				});

				// 添加图例选择变化事件
				chart.on('legendselectchanged', function(params) {
					// 当用户选择/取消选择图例时，图表会自动更新
				});

				// 响应窗口大小变化
				window.addEventListener('resize', function() {
					chart.resize();
				}, {
					passive: true
				});
			}

			function initWindChart() {
				const chartDom = document.getElementById('wind-chart');
				if (!chartDom) {
					console.warn('无法找到wind-chart元素');
					return;
				}

				const chart = echarts.init(chartDom);

				// 处理数据：从北京数据中提取风向和风速信息
				const windData = processWindData('beijing');

				// 八方向数据
				const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
				const directionNames = ['北', '东北', '东', '东南', '南', '西南', '西', '西北'];

				// 准备图表数据
				const windSpeedData = directions.map(dir => {
					return windData[dir] ? windData[dir].avgSpeed : 0;
				});

				const windFrequencyData = directions.map(dir => {
					return windData[dir] ? windData[dir].frequency : 0;
				});

				const option = {
					tooltip: {
						trigger: 'item',
						formatter: function(params) {
							const directionIndex = params.dataIndex;
							const direction = directionNames[directionIndex];
							const speed = windSpeedData[directionIndex];
							const frequency = windFrequencyData[directionIndex];
							return `${direction}风<br/>平均风速: ${speed.toFixed(1)} km/h<br/>出现频率: ${frequency.toFixed(1)}%`;
						}
					},
					title: {
						text: '',
						left: 'center'
					},
					polar: {
						radius: '80%'
					},
					angleAxis: {
						type: 'category',
						data: directionNames, // 使用中文方向名称显示
						startAngle: 90,
						axisLine: {
							lineStyle: {
								color: '#5bc0de'
							}
						},
						axisLabel: {
							color: '#aaccff',
							fontSize: 14,
							fontWeight: 'bold'
						}
					},
					radiusAxis: {
						min: 0,
						axisLine: {
							lineStyle: {
								color: '#5bc0de'
							}
						},
						axisLabel: {
							color: '#aaccff',
							formatter: function(value) {
								return value.toFixed(0);
							},
							show: false // 隐藏半径轴标签
						},
						splitLine: {
							lineStyle: {
								color: 'rgba(91, 192, 222, 0.1)'
							}
						}
					},
					series: [{
						name: '风速与风向',
						type: 'bar',
						coordinateSystem: 'polar',
						data: windSpeedData,
						itemStyle: {
							color: function(params) {
								// 根据风速值设置颜色渐变
								const speed = params.value;
								if (speed < 5) return '#74add1';
								if (speed < 10) return '#abd9e9';
								if (speed < 15) return '#fee090';
								if (speed < 20) return '#fdae61';
								return '#f46d43';
							}
						},
						emphasis: {
							itemStyle: {
								shadowBlur: 10,
								shadowOffsetX: 0,
								shadowColor: 'rgba(0, 0, 0, 0.5)'
							}
						}
					}]
				};

				chart.setOption(option);

				// 响应窗口大小变化
				window.addEventListener('resize', function() {
					chart.resize();
				});
			}

			function processWindData(cityPinyin) {
				const cityData = historicalData[cityPinyin];
				if (!cityData || !cityData.data) {
					console.warn(`没有找到${cityPinyin}的数据`);
					return generateFallbackWindData();
				}

				const windData = {};
				let totalDays = 0;

				// 初始化8个方向的数据结构
				const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
				directions.forEach(dir => {
					windData[dir] = {
						totalSpeed: 0,
						count: 0,
						frequency: 0,
						avgSpeed: 0
					};
				});

				// 处理每条数据
				cityData.data.forEach(day => {
					if (day['风向风力']) {
						totalDays++;

						// 解析风向和风力
						const windInfo = parseWindInfo(day['风向风力']);

						if (windInfo.direction && windInfo.speed) {
							// 将中文风向转换为标准8方位
							const stdDirection = convertChineseWindDirectionTo8(windInfo.direction);

							if (windData[stdDirection]) {
								windData[stdDirection].totalSpeed += windInfo.speed;
								windData[stdDirection].count++;
							} else {
								console.warn(`未知风向: ${windInfo.direction}, 转换为: ${stdDirection}`);
							}
						}
					}
				});

				// 计算平均值和频率
				directions.forEach(dir => {
					if (windData[dir].count > 0) {
						windData[dir].avgSpeed = windData[dir].totalSpeed / windData[dir].count;
						windData[dir].frequency = (windData[dir].count / totalDays) * 100;
					}
				});

				// 更新城市名称显示
				const cityNameElement = document.getElementById('wind-rose-city');
				if (cityNameElement && cityData.name) {
					cityNameElement.textContent = `${cityData.name}风向数据`;
				}

				return windData;
			}

			// 解析风向风力字符串
			function parseWindInfo(windStr) {
				// 示例格式: "东北风 1级"
				const directionMatch = windStr.match(/([\u4e00-\u9fa5]+风)/);
				const speedMatch = windStr.match(/(\d+)级/);

				let direction = null;
				let speed = 0;

				if (directionMatch) {
					direction = directionMatch[1];
				}

				if (speedMatch) {
					speed = parseFloat(speedMatch[1]);
					// 将风级转换为风速(km/h)，使用近似公式: 风速 ≈ 风级 * 5
					speed = speed * 5;
				}

				return {
					direction,
					speed
				};
			}

			// 生成备用数据（当真实数据不可用时）
			function generateFallbackWindData() {
				const directions = ['N', 'NE', 'E', 'SE', 'S', 'SSE', 'SE', 'ESE',
					'E', 'ENE', 'NE', 'NNE', 'N', 'NNW', 'NW', 'WNW'
				];
				const windData = {};

				directions.forEach(dir => {
					windData[dir] = {
						avgSpeed: Math.random() * 15 + 5,
						frequency: Math.random() * 10
					};
				});

				return windData;
			}

			// 新增函数：将中文风向转换为8个标准方向
			function convertChineseWindDirectionTo8(chineseDir) {
				// 更精确的映射
				const directionMap = {
					'北风': 'N',
					'东北风': 'NE',
					'东风': 'E',
					'东南风': 'SE',
					'南风': 'S',
					'西南风': 'SW',
					'西风': 'W',
					'西北风': 'NW',
					'北': 'N',
					'东北': 'NE',
					'东': 'E',
					'东南': 'SE',
					'南': 'S',
					'西南': 'SW',
					'西': 'W',
					'西北': 'NW'
				};

				// 尝试精确匹配
				if (directionMap[chineseDir]) {
					return directionMap[chineseDir];
				}

				// 尝试包含匹配
				for (const key in directionMap) {
					if (chineseDir.includes(key)) {
						return directionMap[key];
					}
				}

				console.warn(`无法识别风向: ${chineseDir}，使用默认值北风`);
				return 'N'; // 默认返回北风
			}

			// 初始化页面
			document.addEventListener('DOMContentLoaded', function() {
				// 加载资源
				loadResources();
				// 加载历史数据
				loadHistoricalData();

				// 初始化图表
				initWindyChart();
				initCityCharts();
				initDataCharts();

				// 启动数据轮询
				startDataPolling();

				// 为风向玫瑰图链接添加点击事件
				const windRoseLink = document.getElementById('wind-rose-link');
				if (windRoseLink) {
					windRoseLink.addEventListener('click', function(e) {
						e.preventDefault();
						// 存储数据到localStorage，以便新页面使用
						localStorage.setItem('windRoseData', JSON.stringify(processWindData('beijing')));
						// 打开新页面
						window.open('wind-rose.html?city=beijing', '_blank');
					});
				}

				// 时间控制按钮事件
				const rewindBtn = getElementSafe('rewind-btn');
				const forwardBtn = getElementSafe('forward-btn');

				if (rewindBtn) {
					rewindBtn.addEventListener('click', function() {
						updateStatus('回退时间...');
						setTimeout(() => updateStatus('风场数据加载完成'), 500);
					}, {
						passive: true
					});
				}

				if (forwardBtn) {
					forwardBtn.addEventListener('click', function() {
						updateStatus('前进时间...');
						setTimeout(() => updateStatus('风场数据加载完成'), 500);
					}, {
						passive: true
					});
				}

				// 更新地图信息显示
				if (windyChart) {
					windyChart.on('mousemove', function(params) {
						if (params.componentType === 'geo' && params.name) {
							const lonValue = getElementSafe('lon-value');
							const latValue = getElementSafe('lat-value');
							const windValue = getElementSafe('wind-value');
							const windDir = getElementSafe('wind-dir');
							const tempValue = getElementSafe('temp-value');
							const humidityValue = getElementSafe('humidity-value');

							if (lonValue) lonValue.textContent = `${params.value[0].toFixed(2)}°E`;
							if (latValue) latValue.textContent = `${params.value[1].toFixed(2)}°N`;

							// 随机生成一些气象数据
							const windSpeed = (Math.random() * 15 + 5).toFixed(1);
							const windDirections = ['北风', '东北风', '东风', '东南风', '南风', '西南风', '西风', '西北风'];
							const randomWindDir = windDirections[Math.floor(Math.random() * windDirections
								.length)];
							const temp = (20 + Math.random() * 15).toFixed(1);
							const humidity = (40 + Math.random() * 40).toFixed(0);

							if (windValue) windValue.textContent = `${windSpeed} km/h`;
							if (windDir) windDir.textContent = randomWindDir;
							if (tempValue) tempValue.textContent = `${temp}°C`;
							if (humidityValue) humidityValue.textContent = `${humidity}%`;
						}
					});
				}
			});
		</script>
	</body>
</html>